<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Items y Pociones de D&D 5e</title>
    <style>
        /* Estilos CSS pueden ser añadidos aquí */
        .ingredient-icon {
            width: 24px;
            height: 24px;
            vertical-align: middle;
        }
        #event-log {
            border: 1px solid #ccc;
            padding: 10px;
            max-height: 200px;
            overflow-y: scroll;
        }
        .section {
            display: inline-block;
            vertical-align: top;
            margin-right: 20px;
        }
    </style>
</head>
<body>
    
    <h1>Generador de Items y Pociones de D&D 5e</h1>

    <div id="inicio-sesion" class="section">
        <h2>Iniciar Sesión</h2>
        <label for="username">Nombre de Usuario:</label>
        <input type="text" id="username">
        <label for="password">Contraseña:</label>
        <input type="password" id="password">
        <button id="login-btn">Iniciar Sesión</button>
        <button id="registro-btn">Registrarse</button>
    </div>

    <div id="inventario-section" class="section" style="display: none;">
        <button id="guardar-localstorage-btn">Guardar Estado</button>
        <h2>Inventario</h2>
        <ul id="inventario">
            <!-- Aquí se mostrarán las cantidades de ingredientes restantes -->
        </ul>
    </div>

    <div id="items-creados-section" class="section" style="display: none;">
        <h2>Items Creados</h2>
        <ul id="lista-items-creados">
            <!-- Aquí se mostrarán los items creados -->
        </ul>
    </div>

    <div id="generador-section" class="section" style="display: none;">
        <label for="recetas">Selecciona una receta:</label>
        <select id="recetas">
            <!-- Las opciones serán agregadas dinámicamente -->
            <option value="Poción de curación">Poción de curación</option>
            <option value="Espada larga">Espada larga</option>
            <!-- Agrega más opciones de recetas conocidas según sea necesario -->
        </select>
        <button id="agregar-ingredientes-receta">Agregar Ingredientes de Receta</button>
        <button id="generar-item">Generar Item</button>
    </div>

    <div id="ingredientes-section" class="section" style="display: none;">
        <h2>Selecciona un ingrediente</h2>
        <ul id="lista-receta"></ul>
        <select id="ingredientes-select">
            <option value="agua">Agua</option>
            <option value="hierbas">Hierbas</option>
            <option value="raíz de mandrágora">Raíz de mandrágora</option>
            <option value="metal">Metal</option>
            <option value="madera">Madera</option>
            <!-- Puedes añadir más opciones aquí -->
        </select>
        <input type="number" id="cantidad-ingredientes" value="1" min="1">
        <button id="agregar-ingrediente">Agregar Ingrediente</button>
        <button id="limpiar-receta">Limpiar Receta</button>
    </div>

    <div id="event-log" class="section" style="display: none;">
        <h2>Eventos</h2>
        <ul id="log-list">
            <!-- Aquí se mostrarán los eventos -->
        </ul>
    </div>

    <script>
        // JavaScript puede ser añadido aquí
        let usuariosRegistrados = [
            { nombre: "usuario1", contraseña: "usuario1" },
            { nombre: "usuario2", contraseña: "usuario2" },
            { nombre: "usuario3", contraseña: "usuario3" },
            { nombre: "usuario4", contraseña: "usuario4" },
            { nombre: "usuario5", contraseña: "usuario5" }
        ];

        let recetasConocidas = [];
        let recetas = [
            { nombre: "Poción de curación", materiales: { agua: 1, hierbas: 1, "raíz de mandrágora": 1 }, efecto: "Cura 2d4 + 2 puntos de golpe." },
            { nombre: "Espada larga", materiales: { metal: 2, madera: 1 }, efecto: "Arma cuerpo a cuerpo que causa 1d8 de daño cortante." }
            // Puedes añadir más recetas aquí
        ];

        let recetaPersonalizada = {
            nombre: "Receta personalizada",
            materiales: {}
        };

        let inventario = {
            agua: 10,
            hierbas: 10,
            "raíz de mandrágora": 10,
            metal: 10,
            madera: 10
        };

        let itemsCreados = [];

        function mostrarInventario() {
            const inventarioList = document.getElementById("inventario");
            inventarioList.innerHTML = ""; // Limpiamos la lista de inventario

            for (const [ingrediente, cantidad] of Object.entries(inventario)) {
                const listItem = document.createElement("li");
                listItem.textContent = `${ingrediente}: ${cantidad}`;
                inventarioList.appendChild(listItem);
            }
        }

        function mostrarItemsCreados() {
            const itemsList = document.getElementById("lista-items-creados");
            itemsList.innerHTML = ""; // Limpiamos la lista de items creados

            itemsCreados.forEach(item => {
                const listItem = document.createElement("li");
                listItem.textContent = item;
                itemsList.appendChild(listItem);
            });
        }

        function mostrarRecetas() {
            const recetasSelect = document.getElementById("recetas");
            recetasSelect.innerHTML = ""; // Limpiamos el dropdown de recetas

            recetasConocidas.forEach(receta => {
                const option = document.createElement("option");
                option.value = receta;
                option.textContent = receta;
                recetasSelect.appendChild(option);
            });
        }

        function mostrarRecetaPersonalizada() {
            const recetaList = document.getElementById("lista-receta");
            recetaList.innerHTML = ""; // Limpiamos la lista de receta personalizada

            for (const [ingrediente, cantidad] of Object.entries(recetaPersonalizada.materiales)) {
                const listItem = document.createElement("li");
                listItem.textContent = `${ingrediente}: ${cantidad}`;
                recetaList.appendChild(listItem);
            }
        }

        function agregarIngrediente() {
            const ingredienteSeleccionado = document.getElementById("ingredientes-select").value;
            const cantidadSeleccionada = parseInt(document.getElementById("cantidad-ingredientes").value);
            if (ingredienteSeleccionado && cantidadSeleccionada > 0 && inventario[ingredienteSeleccionado] >= cantidadSeleccionada) {
                if (recetaPersonalizada.materiales.hasOwnProperty(ingredienteSeleccionado)) {
                    recetaPersonalizada.materiales[ingredienteSeleccionado] += cantidadSeleccionada;
                } else {
                    recetaPersonalizada.materiales[ingredienteSeleccionado] = cantidadSeleccionada;
                }
                inventario[ingredienteSeleccionado] -= cantidadSeleccionada;
                mostrarInventario();
                mostrarRecetaPersonalizada();
            } else {
                agregarEvento("No tienes suficientes ingredientes.");
            }
        }

        function limpiarReceta() {
            for (const [ingrediente, cantidad] of Object.entries(recetaPersonalizada.materiales)) {
                inventario[ingrediente] += cantidad;
            }
            recetaPersonalizada.materiales = {};
            mostrarInventario();
            mostrarRecetaPersonalizada();
        }

        function generarItem() {
            // Verificamos si los ingredientes seleccionados coinciden con alguna receta conocida
            const recetaCoincidente = recetas.find(receta => sonMismosIngredientes(receta, recetaPersonalizada));

            if (recetaCoincidente) {
                // Verificamos si la receta coincide con una receta conocida
                const itemGenerado = recetaCoincidente.nombre;
                itemsCreados.push(itemGenerado);
                mostrarItemsCreados();
                guardarEstadoUsuario(getUsuarioActual());
                if (!recetasConocidas.includes(itemGenerado)) {
                    recetasConocidas.push(itemGenerado);
                    mostrarRecetas(); // Mostramos las recetas conocidas actualizadas
                }

                alert("¡Item generado exitosamente: " + itemGenerado + "!");
            } else {
                alert("¡No hay una receta conocida que coincida con los ingredientes seleccionados!");
            }
        }

        function sonMismosIngredientes(receta1, receta2) {
            const ingredientes1 = receta1.materiales;
            const ingredientes2 = receta2.materiales;
            const keys1 = Object.keys(ingredientes1);
            const keys2 = Object.keys(ingredientes2);
            if (keys1.length !== keys2.length) return false;
            for (const key of keys1) {
                if (ingredientes1[key] !== ingredientes2[key]) return false;
            }
            return true;
        }

        // Función para agregar un evento al log
        function agregarEvento(evento) {
            const logList = document.getElementById("log-list");
            const listItem = document.createElement("li");
            listItem.textContent = evento;
            logList.appendChild(listItem);
        }
// Función para obtener el usuario actual desde localStorage
function getUsuarioActual() {
    return localStorage.getItem("usuarioActual");
}
      // Evento para el botón de iniciar sesión
document.getElementById("login-btn").addEventListener("click", function() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    const usuario = usuariosRegistrados.find(user => user.nombre === username && user.contraseña === password);
    if (usuario) {
        // Simulación de inicio de sesión exitoso
        agregarEvento("Inicio de sesión exitoso para el usuario: " + username);
        document.getElementById("inicio-sesion").style.display = "none";
        document.getElementById("inventario-section").style.display = "inline-block";
        document.getElementById("items-creados-section").style.display = "inline-block";
        document.getElementById("generador-section").style.display = "inline-block";
        document.getElementById("ingredientes-section").style.display = "inline-block";
        document.getElementById("resultado").style.display = "inline-block";
        // Establecer usuario actual en localStorage
        localStorage.setItem("usuarioActual", username);
        // Cargar datos del usuario desde localStorage
        cargarEstadoUsuario(username);
    } else {
        agregarEvento("Inicio de sesión fallido: ¡Nombre de usuario o contraseña incorrectos!");
    }
});
// Verificar si hay un usuario actual almacenado en localStorage al cargar la página
window.addEventListener("load", function() {
    const usuarioActual = getUsuarioActual();
    if (usuarioActual) {
        // Ocultar formulario de inicio de sesión y mostrar secciones relevantes
        document.getElementById("inicio-sesion").style.display = "none";
        document.getElementById("inventario-section").style.display = "inline-block";
        document.getElementById("items-creados-section").style.display = "inline-block";
        document.getElementById("generador-section").style.display = "inline-block";
        document.getElementById("ingredientes-section").style.display = "inline-block";
        document.getElementById("resultado").style.display = "inline-block";
        // Cargar datos del usuario desde localStorage
        cargarEstadoUsuario(usuarioActual);
    }
});
       // Evento para el botón de registro
document.getElementById("registro-btn").addEventListener("click", function() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    if (username && password) {
        // Verificar si el usuario ya existe
        const usuarioExistente = usuariosRegistrados.find(user => user.nombre === username);
        if (usuarioExistente) {
            agregarEvento("Registro fallido: ¡El nombre de usuario ya está en uso!");
        } else {
            // Simulación de registro exitoso
            agregarEvento("Usuario registrado exitosamente: " + username);
            document.getElementById("inicio-sesion").style.display = "none";
            document.getElementById("inventario-section").style.display = "inline-block";
            document.getElementById("items-creados-section").style.display = "inline-block";
            document.getElementById("generador-section").style.display = "inline-block";
            document.getElementById("ingredientes-section").style.display = "inline-block";
            document.getElementById("resultado").style.display = "inline-block";
            // Guardar el nombre de usuario en localStorage
            localStorage.setItem("usuarioActual", username);
            // Agregar nuevo usuario registrado a la lista
            usuariosRegistrados.push({ nombre: username, contraseña: password });
            // Guardar estado del usuario en cookies
            guardarEstadoUsuario(username);
        }
    } else {
        agregarEvento("Registro fallido: ¡Ingrese un nombre de usuario y contraseña!");
    }
});


        // Evento para el botón de agregar ingredientes de receta
        document.getElementById("agregar-ingredientes-receta").addEventListener("click", function() {
            const recetaSeleccionada = document.getElementById("recetas").value;
            const recetaEncontrada = recetas.find(receta => receta.nombre === recetaSeleccionada);

            if (recetaEncontrada) {
                for (const [ingrediente, cantidad] of Object.entries(recetaEncontrada.materiales)) {
                    if (inventario[ingrediente] >= cantidad) {
                        if (recetaPersonalizada.materiales.hasOwnProperty(ingrediente)) {
                            recetaPersonalizada.materiales[ingrediente] += cantidad;
                        } else {
                            recetaPersonalizada.materiales[ingrediente] = cantidad;
                        }
                        inventario[ingrediente] -= cantidad;
                    } else {
                        agregarEvento("No tienes suficientes ingredientes para esta receta.");
                        return; // Salir de la función si no hay suficientes ingredientes
                    }
                }
                mostrarInventario();
                mostrarRecetaPersonalizada();
                agregarEvento("Ingredientes de receta agregados con éxito.");
            } else {
                agregarEvento("Error: Receta seleccionada no encontrada.");
            }
        });

        // Evento para el botón de generar item
        document.getElementById("generar-item").addEventListener("click", generarItem);

        // Evento para el botón de agregar ingrediente a la receta personalizada
        document.getElementById("agregar-ingrediente").addEventListener("click", agregarIngrediente);

        // Evento para el botón de limpiar receta personalizada
        document.getElementById("limpiar-receta").addEventListener("click", limpiarReceta);

      function guardarEstadoUsuario(username) {
    localStorage.setItem(username + "-itemsCreados", JSON.stringify(itemsCreados)); // Guardar items creados
    localStorage.setItem(username + "-inventario", JSON.stringify(inventario)); // Guardar estado del inventario
    localStorage.setItem("usuariosRegistrados", JSON.stringify(usuariosRegistrados)); // Guardar usuarios registrados
    console.log("Datos guardados en localStorage para el usuario:", username);
}

       // Función para cargar el estado del usuario desde localStorage
function cargarEstadoUsuario(username) {
    const itemsCreadosLocalStorage = localStorage.getItem(username + "-itemsCreados");
    if (itemsCreadosLocalStorage) {
        itemsCreados = JSON.parse(itemsCreadosLocalStorage);
        mostrarItemsCreados();
        console.log("Datos cargados desde localStorage para items creados del usuario:", username);
    }

    const inventarioLocalStorage = localStorage.getItem(username + "-inventario");
    if (inventarioLocalStorage) {
        inventario = JSON.parse(inventarioLocalStorage);
        mostrarInventario();
        console.log("Datos cargados desde localStorage para inventario del usuario:", username);
    }
}

// Evento para el botón de guardar información en localStorage
document.getElementById("guardar-localstorage-btn").addEventListener("click", function() {
    const username = localStorage.getItem("usuarioActual");
    if (username) {
        guardarEstadoUsuario(username);
        alert("¡Información guardada en localStorage!");
    } else {
        alert("No hay usuario actualmente iniciado sesión.");
    }
});
        // Función para obtener el nombre de usuario actual
        function getUsuarioActual() {
            return document.getElementById("username").value;
        }

        // Mostrar recetas iniciales
        mostrarRecetas();

    </script>
</body>
</html>
