<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Items y Pociones de D&D 5e</title>
    <style>
        /* Estilos CSS pueden ser añadidos aquí */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .section > * {
            margin-bottom: 10px;
        }

        #inicio-sesion {
            display: block;
        }

        #inventario-section,
        #items-creados-section,
        #generador-section,
        #ingredientes-section,
        #event-log,
        #agregar-inventario-section,
        #guardar-localstorage-btn {
            display: none;
        }
    </style>
</head>
<body>
    
    <div class="container">

        <h1>Generador de Items y Pociones de D&D 5e</h1>

        <!-- Inicio de Sesión -->
        <div id="inicio-sesion" class="section">
            <h2>Iniciar Sesión</h2>
            <label for="username">Nombre de Usuario:</label>
            <input type="text" id="username">
            <label for="password">Contraseña:</label>
            <input type="password" id="password">
            <button id="login-btn">Iniciar Sesión</button>
            <button id="registro-btn">Registrarse</button>
        </div>

        <!-- Botón Guardar Estado -->
        <div class="section">
            <button id="guardar-localstorage-btn" >Guardar Estado</button>
        </div>

        <!-- Lista de Items Creados -->
        <div id="items-creados-section" class="section">
            <h2>Items Creados</h2>
            <ul id="lista-items-creados">
                <!-- Aquí se mostrarán los items creados -->
            </ul>
        </div>

        <!-- Seleccionar Receta, Agregar Ingredientes de Receta y Generar Item -->
        <div id="generador-section" class="section">
            <label for="recetas">Selecciona una receta:</label>
            <select id="recetas">
                <!-- Las opciones serán agregadas dinámicamente -->
            </select>
            <button id="agregar-ingredientes-receta">Agregar Ingredientes de Receta</button>
            <button id="generar-item">Generar Item</button>
        </div>

        <!-- Seleccionar un Ingrediente, Selector de Cantidad, Agregar Ingrediente y Limpiar Receta -->
        <div id="ingredientes-section" class="section">
            <h2>Selecciona un ingrediente</h2>
            <ul id="lista-receta"></ul>
            <select id="ingredientes-select">
                <!-- Puedes añadir más opciones aquí -->
            </select>
            <input type="number" id="cantidad-ingredientes" value="1" min="1">
            <button id="agregar-ingrediente">Agregar Ingrediente</button>
            <button id="limpiar-receta">Limpiar Receta</button>
        </div>

        <!-- Botones para Agregar Ingredientes Básicos, Intermedios y Avanzados -->
        <div id="agregar-inventario-section" class="section">
            <h2>Agregar Ingredientes al Inventario</h2>
            <button id="agregar-basico">Agregar Ingredientes Básicos</button>
            <button id="agregar-intermedio">Agregar Ingredientes Intermedios</button>
            <button id="agregar-avanzado">Agregar Ingredientes Avanzados</button>
        </div>

        <!-- Log de Eventos -->
        <div id="event-log" class="section">
            <h2>Eventos</h2>
            <ul id="log-list">
                <!-- Aquí se mostrarán los eventos -->
            </ul>
        </div>
    
    </div>

    <script>
        // JavaScript puede ser añadido aquí
        let usuariosRegistrados = [
            { nombre: "usuario1", contraseña: "usuario1" },
            { nombre: "usuario2", contraseña: "usuario2" },
            { nombre: "usuario3", contraseña: "usuario3" },
            { nombre: "usuario4", contraseña: "usuario4" },
            { nombre: "usuario5", contraseña: "usuario5" }
        ];

        let recetasConocidas = [];
        let recetas = [
            { nombre: "Poción de curación", materiales: { Agua: 1, Hierbas: 1, "Raíz de mandrágora": 1 }, efecto: "Cura 2d4 + 2 puntos de golpe." },
            { nombre: "Espada larga", materiales: { Metal: 2, Madera: 1 }, efecto: "Arma cuerpo a cuerpo que causa 1d8 de daño cortante." }
            // Puedes añadir más recetas aquí
        ];

        let recetaPersonalizada = {
            nombre: "Receta personalizada",
            materiales: {}
        };

        let inventario = {
            Agua: 10,
            Hierbas: 5,
            "Raíz de mandrágora": 3,
            Metal: 0,
            Madera: 0,
            Oro: 0,
            Diamante: 0
        };

        const ingredientesBasico = [
            { nombre: "Agua", cantidad: 5 },
            { nombre: "Hierbas", cantidad: 5 },
            { nombre: "Raíz de mandrágora", cantidad: 5 }
        ];

        const ingredientesIntermedio = [
            { nombre: "Metal", cantidad: 3 },
            { nombre: "Madera", cantidad: 3 }
        ];

        const ingredientesAvanzado = [
            { nombre: "Oro", cantidad: 1 },
            { nombre: "Diamante", cantidad: 1 }
        ];

        let itemsCreados = [];

        function mostrarInventario() {
            const ingredientesSelect = document.getElementById("ingredientes-select");
            ingredientesSelect.innerHTML = "";

            for (const ingrediente in inventario) {
                if (inventario[ingrediente] > 0) { // Solo mostramos los ingredientes con cantidad mayor a 0
                    const opcion = document.createElement("option");
                    opcion.value = ingrediente;
                    opcion.textContent = ingrediente + " (" + inventario[ingrediente] + ")";
                    ingredientesSelect.appendChild(opcion);
                }
            }
        }

        function mostrarItemsCreados() {
            const itemsList = document.getElementById("lista-items-creados");
            itemsList.innerHTML = ""; // Limpiamos la lista de items creados

            itemsCreados.forEach(item => {
                const listItem = document.createElement("li");
                listItem.textContent = item;
                itemsList.appendChild(listItem);
            });
        }

        function mostrarRecetaPersonalizada() {
            const recetaList = document.getElementById("lista-receta");
            recetaList.innerHTML = ""; // Limpiamos la lista de receta personalizada

            for (const [ingrediente, cantidad] of Object.entries(recetaPersonalizada.materiales)) {
                const listItem = document.createElement("li");
                // Agregamos el icono junto al nombre del ingrediente
                const icono = document.createElement("img");
                icono.src = "amplitude.svg"; // Ruta al icono correspondiente
                icono.width = 16;
                icono.height = 16;
                listItem.appendChild(icono);
                listItem.textContent = `${ingrediente}: ${cantidad}`;
                recetaList.appendChild(listItem);
            }
        }

        function agregarIngrediente() {
            const ingredienteSeleccionado = document.getElementById("ingredientes-select").value;
            const cantidadSeleccionada = parseInt(document.getElementById("cantidad-ingredientes").value);

            if (ingredienteSeleccionado && cantidadSeleccionada > 0) {
                if (inventario[ingredienteSeleccionado] >= cantidadSeleccionada) {
                    if (recetaPersonalizada.materiales.hasOwnProperty(ingredienteSeleccionado)) {
                        recetaPersonalizada.materiales[ingredienteSeleccionado] += cantidadSeleccionada;
                    } else {
                        recetaPersonalizada.materiales[ingredienteSeleccionado] = cantidadSeleccionada;
                    }
                    inventario[ingredienteSeleccionado] -= cantidadSeleccionada;
                    mostrarInventario();
                    mostrarRecetaPersonalizada();
                } else {
                    agregarEvento("No tienes suficientes " + ingredienteSeleccionado + " en el inventario.");
                }
            } else {
                agregarEvento("Por favor, selecciona un ingrediente y una cantidad válida.");
            }
        }

        function limpiarReceta() {
            for (const [ingrediente, cantidad] of Object.entries(recetaPersonalizada.materiales)) {
                inventario[ingrediente] += cantidad;
            }
            recetaPersonalizada.materiales = {};
            mostrarInventario();
            mostrarRecetaPersonalizada();
        }

        function generarItem() {
            // Verificamos si los ingredientes seleccionados coinciden con alguna receta conocida
            const recetaCoincidente = recetas.find(receta => sonMismosIngredientes(receta, recetaPersonalizada));

            if (recetaCoincidente) {
                // Restar los ingredientes del inventario
                for (const [ingrediente, cantidad] of Object.entries(recetaCoincidente.materiales)) {
                    inventario[ingrediente] -= cantidad;
                }

                // Eliminar los ingredientes del inventario que tienen una cantidad igual a cero
                for (const ingrediente in inventario) {
                    if (inventario[ingrediente] === 0) {
                        delete inventario[ingrediente];
                    }
                }

                // Actualizar la lista de selección de ingredientes
                mostrarInventario();

                const itemGenerado = recetaCoincidente.nombre;
                itemsCreados.push(itemGenerado);
                mostrarItemsCreados();

                if (!recetasConocidas.includes(itemGenerado)) {
                    recetasConocidas.push(itemGenerado);
                    mostrarRecetas(); // Mostramos las recetas conocidas actualizadas
                }

                alert("¡Item generado exitosamente: " + itemGenerado + "!");
                // Actualizar el inventario mostrado
                mostrarInventario();
            } else {
                alert("¡No hay una receta conocida que coincida con los ingredientes seleccionados!");
            }
        }

        function sonMismosIngredientes(receta1, receta2) {
            const ingredientes1 = receta1.materiales;
            const ingredientes2 = receta2.materiales;
            const keys1 = Object.keys(ingredientes1);
            const keys2 = Object.keys(ingredientes2);
            if (keys1.length !== keys2.length) return false;
            for (const key of keys1) {
                if (ingredientes1[key] !== ingredientes2[key]) return false;
            }
            return true;
        }

        // Función para agregar un evento al log
        function agregarEvento(evento) {
            const logList = document.getElementById("log-list");
            const listItem = document.createElement("li");
            listItem.textContent = evento;
            logList.appendChild(listItem);
        }
        // Función para obtener el usuario actual desde localStorage
        function getUsuarioActual() {
            return localStorage.getItem("usuarioActual");
        }

        // Eventos para los botones de agregar ingredientes
        document.getElementById("agregar-basico").addEventListener("click", () => {
            for (const ingrediente of ingredientesBasico) {
                if (ingrediente.nombre in inventario) {
                    inventario[ingrediente.nombre] += ingrediente.cantidad;
                } else {
                    inventario[ingrediente.nombre] = ingrediente.cantidad;
                }
            }
            mostrarInventario();
        });

        document.getElementById("agregar-intermedio").addEventListener("click", () => {
            for (const ingrediente of ingredientesIntermedio) {
                if (ingrediente.nombre in inventario) {
                    inventario[ingrediente.nombre] += ingrediente.cantidad;
                } else {
                    inventario[ingrediente.nombre] = ingrediente.cantidad;
                }
            }
            mostrarInventario();
        });

        document.getElementById("agregar-avanzado").addEventListener("click", () => {
            for (const ingrediente of ingredientesAvanzado) {
                if (ingrediente.nombre in inventario) {
                    inventario[ingrediente.nombre] += ingrediente.cantidad;
                } else {
                    inventario[ingrediente.nombre] = ingrediente.cantidad;
                }
            }
            mostrarInventario();
        });

        // Eventos para los botones de inicio de sesión y registro
        document.getElementById("login-btn").addEventListener("click", () => {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const usuario = usuariosRegistrados.find(user => user.nombre === username && user.contraseña === password);
            if (usuario) {
                alert("Inicio de sesión exitoso.");
                localStorage.setItem("usuarioActual", username);
                document.getElementById("inicio-sesion").style.display = "none";
                document.getElementById("inventario-section").style.display = "block";
                document.getElementById("generador-section").style.display = "block";
                mostrarInventario();
                mostrarRecetas();
            } else {
                alert("Nombre de usuario o contraseña incorrectos.");
            }
        });

        document.getElementById("registro-btn").addEventListener("click", () => {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            if (username && password) {
                if (usuariosRegistrados.find(user => user.nombre === username)) {
                    alert("El nombre de usuario ya está registrado.");
                } else {
                    usuariosRegistrados.push({ nombre: username, contraseña: password });
                    alert("Registro exitoso. Por favor, inicia sesión.");
                }
            } else {
                alert("Por favor, ingresa un nombre de usuario y una contraseña válidos.");
            }
        });

        // Eventos para el botón de guardar estado
        document.getElementById("guardar-localstorage-btn").addEventListener("click", () => {
            localStorage.setItem("inventario", JSON.stringify(inventario));
            localStorage.setItem("itemsCreados", JSON.stringify(itemsCreados));
            alert("Estado guardado en localStorage.");
        });

        // Eventos para el generador de items
        document.getElementById("agregar-ingrediente").addEventListener("click", agregarIngrediente);
        document.getElementById("limpiar-receta").addEventListener("click", limpiarReceta);
        document.getElementById("generar-item").addEventListener("click", generarItem);

        // Mostrar el inicio de sesión o el inventario dependiendo de si hay un usuario actual
        const usuarioActual = getUsuarioActual();
        if (usuarioActual) {
            document.getElementById("inicio-sesion").style.display = "none";
            document.getElementById("inventario-section").style.display = "block";
            document.getElementById("generador-section").style.display = "block";
            mostrarInventario();
            mostrarRecetas();
        } else {
            document.getElementById("inicio-sesion").style.display = "block";
        }

        // Mostrar recetas conocidas
        function mostrarRecetas() {
            const recetasSelect = document.getElementById("recetas");
            recetasSelect.innerHTML = "";

            recetas.forEach(receta => {
                const opcion = document.createElement("option");
                opcion.value = receta.nombre;
                opcion.textContent = receta.nombre;
                recetasSelect.appendChild(opcion);
            });

            recetasConocidas.forEach(nombre => {
                const opcion = document.createElement("option");
                opcion.value = nombre;
                opcion.textContent = nombre;
                recetasSelect.appendChild(opcion);
            });
        }
    </script>

</body>
</html>
