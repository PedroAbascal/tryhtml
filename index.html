<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jacquard+24&display=swap" rel="stylesheet">

    
    <title>Generador de Items y Pociones de D&D 5e</title>
    <style>
        /* Estilos CSS pueden ser añadidos aquí */
        body {
            /* Imagen de fondo */
            background-image: url(https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/an_alchemist_workshop_by_ai_postcards_dfhoy48-fullview.jpg);
            background-size: cover; /* Para cubrir todo el fondo */
            background-repeat: no-repeat; /* Para que la imagen no se repita */
            background-attachment: fixed; /* Para fijar la imagen mientras se desplaza la página */

            /* CSS */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: rgba(252, 190, 43, 0.5); /* Amarillo anaranjado con una transparencia del 50% */
            padding: 10px; /* Añade un espacio alrededor del texto para que el fondo sea visible */
            border-radius: 5px; /* Para suavizar los bordes del fondo */
        }

        .section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
           
        }

            .jacquard-24-regular {
              font-family: "Jacquard 24", system-ui;
              font-weight: 400;
              font-style: normal;
                                }
        
            h1, h2, h3, h4, h5, h6 
        {
            font-family: "Jacquard 24", system-ui; /* Aplica la fuente */
            background-color: rgba(252, 190, 43, 0.5);
            padding: 10px; /* Añade un espacio alrededor del texto para que el fondo sea visible */
            border-radius: 5px; /* Para suavizar los bordes del fondo */
            color: 	#000000; /* Cambiar el color del texto */
            
        }
        
        .section > * {
            margin-bottom: 10px;
        }

        .icono {
        width: 50px; /* Tamaño fijo */
        height: 50px; /* Se ajusta automáticamente */
        }

        #inicio-sesion {
            display: block;
        }

        #inventario-section,
        #items-creados-section,
        #generador-section,
        #ingredientes-section,
        #event-log,
        #agregar-inventario-section,
        #guardar-localstorage-btn {
            display: none;
        }
    </style>
</head>
<body>
    
    <div class="container">
        
        <!-- Agrega un elemento div con un ID específico para el tooltip -->
        <div id="tooltip" style="position: absolute; display: none; background-color: rgba(0, 0, 0, 0.7); color: white; padding: 5px; border-radius: 5px;"></div>
        
        <h1>Generador de Items y Pociones de D&D 5e</h1>

        <!-- Inicio de Sesión -->
        <div id="inicio-sesion" class="section">
            <h2>Iniciar Sesión</h2>
            <label for="username">Nombre de Usuario:</label>
            <input type="text" id="username">
            <label for="password">Contraseña:</label>
            <input type="password" id="password">
            <button id="login-btn">Iniciar Sesión</button>
            <button id="registro-btn">Registrarse</button>
        </div>

        <!-- Botón Guardar Estado -->
        <div class="section">
            <button id="guardar-localstorage-btn" >Guardar Estado</button>
        </div>

        <!-- Lista de Items Creados -->
        <div id="items-creados-section" class="section">
            <h2>Items Creados</h2>
            <ul id="lista-items-creados">
                <!-- Aquí se mostrarán los items creados -->
            </ul>
        </div>

        <!-- Seleccionar Receta, Agregar Ingredientes de Receta y Generar Item -->
        <div id="generador-section" class="section">
    <label for="recetas">Selecciona una receta:</label>
    <select id="recetas">
        <!-- Las opciones serán agregadas dinámicamente -->
    </select>
    <button id="agregar-ingredientes-receta">Agregar Ingredientes de Receta</button>
    <button id="generar-item">Generar Item</button>
    <button id="procesar-ingrediente">Procesar Ingrediente</button>
</div>

        <!-- Seleccionar un Ingrediente, Selector de Cantidad, Agregar Ingrediente y Limpiar Receta -->
        <div id="ingredientes-section" class="section">
            <h2>Selecciona un ingrediente</h2
            <ul id="lista-receta"></ul>
            <ul id="lista-ingredientes" class="ingredientes-lista">
        <!-- Los ingredientes del inventario se añadirán aquí dinámicamente -->
    </ul>
            <input type="number" id="cantidad-ingredientes" value="1" min="1">
            <button id="agregar-ingrediente">Agregar Ingrediente</button>
            <button id="limpiar-receta">Limpiar Receta</button>
        </div>

        <!-- Botones para Agregar Ingredientes Básicos, Intermedios y Avanzados -->
        <div id="agregar-inventario-section" class="section">
            <h2>Agregar Ingredientes al Inventario</h2>
            <button id="agregar-basico">Agregar Ingredientes Básicos</button>
            <button id="agregar-intermedio">Agregar Ingredientes Intermedios</button>
            <button id="agregar-avanzado">Agregar Ingredientes Avanzados</button>
        </div>

        <!-- Log de Eventos -->
        <div id="event-log" class="section">
            <h2>Eventos</h2>
            <ul id="log-list">
                <!-- Aquí se mostrarán los eventos -->
            </ul>
        </div>
    
    </div>

    <script>
        // JavaScript puede ser añadido aquí
        let usuariosRegistrados = [
            { nombre: "usuario1", contraseña: "usuario1" },
            { nombre: "usuario2", contraseña: "usuario2" },
            { nombre: "usuario3", contraseña: "usuario3" },
            { nombre: "usuario4", contraseña: "usuario4" },
            { nombre: "usuario5", contraseña: "usuario5" }
        ];

        let recetasConocidas = [];
        let recetas = [
            { nombre: "Poción de curación", materiales: { Agua: 1, Hierbas: 1, "Raíz de mandrágora": 1 }, efecto: "Cura 2d4 + 2 puntos de golpe." },
            { nombre: "Espada larga", materiales: { Metal: 2, Madera: 1 }, efecto: "Arma cuerpo a cuerpo que causa 1d8 de daño cortante." },
            // Puedes añadir más recetas aquí
            {
        nombre: "Poción de curación",
        materiales: { "Néctar de flores": 1, "Escamas de pez": 1, "Polen de abeja": 1 },
        efecto: "Cura 2d4 + 2 puntos de golpe."
    },
    {
        nombre: "Espada de élfica",
        materiales: { "Orejas de elfo": 2, "Pluma de cuervo": 1, "Escamas de dragón bebé": 1 },
        efecto: "Arma cuerpo a cuerpo que causa 1d8 de daño cortante."
    },
    {
        nombre: "Poción de velocidad",
        materiales: { "Polvo de hada": 1, "Savia de árbol antiguo": 1, "Piedra de luna": 1 },
        efecto: "Aumenta la velocidad de movimiento en 30 pies durante 1 hora."
    },
    {
        nombre: "Piedra de fuego",
        materiales: { "Lágrimas de fénix": 1, "Esencia de estrella": 1, "Sangre de titán": 1 },
        efecto: "Al lanzarla al suelo, crea una explosión de fuego en un radio de 20 pies."
    },
    {
        nombre: "Armadura de titán",
        materiales: { "Residuo de meteorito": 5, "Piedra de alma": 1, "Escencia de dragón antiguo": 1 },
        efecto: "Armadura que otorga resistencia a todos los daños y aumenta la fuerza en 2 puntos."
    },
    // Agrega más recetas aquí si es necesario
    {
        nombre: "Elixir de invisibilidad",
        materiales: { "Polvo de invisibilidad": 1, "Lágrimas de sombra": 1, "Pluma de murciélago": 1 },
        efecto: "Te vuelve invisible durante 1 hora."
    },
    {
        nombre: "Arco del cazador",
        materiales: { "Cuerno de ciervo": 2, "Pelo de lobo": 1, "Pluma de águila": 1 },
        efecto: "Arco que causa daño extra a criaturas bestiales."
    },
    {
        nombre: "Poción de resistencia",
        materiales: { "Fluido de resistencia": 1, "Planta de vigor": 1, "Escarabajo endurecido": 1 },
        efecto: "Aumenta la resistencia a daño durante 1 hora."
    },
    {
        nombre: "Gema de teletransporte",
        materiales: { "Cristal de cuarzo": 1, "Pluma de ave migratoria": 1, "Energía astral": 1 },
        efecto: "Te teletransporta a un lugar conocido."
    },
    {
        nombre: "Capa de camuflaje",
        materiales: { "Pieles de camaleón": 2, "Hilo de araña": 1, "Planta mimética": 1 },
        efecto: "Te permite camuflarte en tu entorno."
    },
    // Agrega más recetas aquí si es necesario
];
        

        let recetaPersonalizada = {
            nombre: "Receta personalizada",
            materiales: {}
        };

        let inventario = {
    Agua: 10,
    Hierbas: 5,
    "Raíz de mandrágora": 3,
    Metal: 0,
    Madera: 0,
            Oro: 0,
            Diamante: 0,
             "Néctar de flores": 0,
    "Escamas de pez":0,
    "Polen de abeja":0,
    "Pulpa de frutas":0,
    "Tierra fértil":0,
    "Musgo fresco":0,
    "Agua de manantial":0,
    "Pluma de cuervo":0,
    "Hojas de menta":0,
    "Rocío de la mañana":0,
    "Alas de mariposa":0,
    "Corteza de árbol":0,
    "Pétalos de rosa":0,
    "Semillas de girasol":0,
    "Azúcar de caña":0,
    "Raíz de jengibre":0,
    "Granos de café":0,
    "Canela molida":0,
    "Pimienta negra":0,
    "Miel silvestre":0,
    "Nuez moscada":0,
    "Sal marina":0,
    "Aceite de oliva":0,
    "Jugo de limón":0,
    "Vinagre de sidra de manzana":0,
    "Menta fresca":0,
    "Ajo triturado":0,
    "Cebolla picada":0,
    "Perejil fresco":0,
    "Tomillo seco":0,
    "Albahaca fresca":0,
    "Cilantro picado":0,
    "Orégano seco":0,
    "Romero fresco":0,
    "Salsa de soja":0,
    "Salsa Worcestershire":0,
    "Mostaza Dijon":0,
    "Salsa de tomate":0,
    "Crema de leche":0,
    "Mantequilla derretida":0,
    "Huevos frescos":0,
    "Leche de almendra":0,
    "Leche de coco":0,
    "Yogur natural":0,
    "Queso rallado":0,
    "Pan rallado":0,
    "Harina de trigo":0,
    "Harina de maíz":0,
    "Levadura en polvo":0,
    "Azúcar glass":0,
    "Orejas de elfo":0,
    "Escamas de dragón bebé":0,
    "Polvo de hada":0,
    "Savia de árbol antiguo":0,
    "Piedra de luna":0,
    "Lengua de basilisco":0,
    "Escamas de salamandra":0,
    "Ojo de gato":0,
    "Colmillo de lobo":0,
    "Garra de oso":0,
    "Pluma de fénix":0,
    "Escama de dragón adulto":0,
    "Cuerno de unicornio":0,
    "Garra de grifo":0,
    "Pelaje de lince":0,
    "Piel de serpiente":0,
    "Espina de gorgona":0,
    "Sangre de vampiro":0,
    "Hueso de esqueleto":0,
    "Escamas de tritón":0,
    "Púa de erizo":0,
    "Garra de águila":0,
    "Colmillo de tigre":0,
    "Sangre de ogro":0,
    "Escamas de quimera":0,
    "Hueso de gigante":0,
    "Pluma de cuervo gigante":0,
    "Lengua de lince":0,
    "Ojo de orco":0,
    "Púa de armadillo":0,
    "Escama de dragón anciano":0,
    "Pelo de lobo de las sombras":0,
    "Hueso de manticora":0,
    "Hilo de araña gigante":0,
    "Colmillo de jabalí":0,
    "Escamas de kraken":0,
    "Colmillo de oso polar":0,
    "Sangre de demonio":0,
    "Diente de tiburón":0,
    "Cuerno de minotauro":0,
    "Garra de grifo":0,
    "Colmillo de dragón rojo":0,
    "Sangre de titán":0,
    "Escamas de gárgola":0,
    "Púa de erizo":0,
    "Colmillo de lobo huargo":0,
    "Escamas de dragón dorado":0,
    "Hueso de quimera":0,
    "Pluma de grifo":0,
    "Cuerno de unicornio negro":0,
    "Lágrimas de fénix":0,
    "Esencia de estrella":0,
    "Sangre de titán":0,
    "Luz de luna llena":0,
    "Residuo de meteorito":0,
    "Piedra de alma":0,
    "Escencia de dragón antiguo":0,
    "Corazón de elemental":0,
    "Polvo de unicornio":0,
    "Aura de hada":0,
    "Pluma de ángel":0,
    "Lágrimas de dios":0,
    "Símbolo de divinidad":0,
    "Resplandor de aurora":0,
    "Esencia de esfinge":0,
    "Polvo de sueños":0,
    "Gema de almas":0,
    "Escama de dragón cromático":0,
    "Ceniza de fénix":0,
            "Pasta de Hierbas Curativas": 0
        
};

        const ingredientesBasico = [
    { nombre: "Agua", cantidad: 5, categoria: "Liquido", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Hierbas", cantidad: 5, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Raíz de mandrágora", cantidad: 5, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Néctar de flores", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Escamas de pez", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Polen de abeja", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Pulpa de frutas", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Tierra fértil", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Musgo fresco", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Agua de manantial", cantidad: 50, categoria: "Liquido", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Pluma de cuervo", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Hojas de menta", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Rocío de la mañana", cantidad: 50, categoria: "Liquido", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" }
];

const ingredientesIntermedio = [
    { nombre: "Metal", cantidad: 3, categoria: "Metalico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Madera", cantidad: 3, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Orejas de elfo", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Escamas de dragón bebé", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Polvo de hada", cantidad: 50, categoria: "Magico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Savia de árbol antiguo", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Piedra de luna", cantidad: 50, categoria: "Cristalino", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Lengua de basilisco", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Escamas de salamandra", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Ojo de gato", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Colmillo de lobo", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Garra de oso", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" }
];

const ingredientesAvanzado = [
    { nombre: "Oro", cantidad: 1, categoria: "Metalico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Diamante", cantidad: 1, categoria: "Cristalino", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Lágrimas de fénix", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Esencia de estrella", cantidad: 50, categoria: "Magico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Sangre de titán", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Luz de luna llena", cantidad: 50, categoria: "Magico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Residuo de meteorito", cantidad: 50, categoria: "Cristalino", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Piedra de alma", cantidad: 50, categoria: "Cristalino", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Escencia de dragón antiguo", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Corazón de elemental", cantidad: 50, categoria: "Magico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Polvo de unicornio", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Aura de hada", cantidad: 50, categoria: "Magico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" }
];
        let itemsCreados = [];

        const listaIngredientes = document.getElementById("lista-ingredientes");


function obtenerIngredientesInventario() {
    // Obtener el nombre de usuario actual
    const usuarioActual = getUsuarioActual();
    
    // Verificar si hay datos en el localStorage para el inventario del usuario actual
    const datosInventario = localStorage.getItem(`${usuarioActual}-inventario`);
    
    // Si hay datos en el localStorage para el inventario del usuario actual, parsearlos a un objeto JavaScript
    // De lo contrario, devolver un objeto vacío
    return datosInventario ? JSON.parse(datosInventario) : {};
}

// Función para obtener la URL del icono basado en el nombre del ingrediente
function obtenerURLIcono(nombre) {
    // Buscar el nombre del ingrediente en la lista de ingredientes básicos
    const ingredienteBasico = ingredientesBasico.find(ingrediente => ingrediente.nombre === nombre);
    if (ingredienteBasico) {
        return ingredienteBasico.icono;
    }

    // Buscar el nombre del ingrediente en la lista de ingredientes intermedios
    const ingredienteIntermedio = ingredientesIntermedio.find(ingrediente => ingrediente.nombre === nombre);
    if (ingredienteIntermedio) {
        return ingredienteIntermedio.icono;
    }

    // Buscar el nombre del ingrediente en la lista de ingredientes avanzados
    const ingredienteAvanzado = ingredientesAvanzado.find(ingrediente => ingrediente.nombre === nombre);
    if (ingredienteAvanzado) {
        return ingredienteAvanzado.icono;
    }

    // Devolver null si no se encontró el nombre del ingrediente en ninguna lista
    return null;
}
        
// Función para obtener los ingredientes del inventario desde el localStorage
function renderizarIngredientes() {
    // Limpiar la lista de ingredientes antes de volver a renderizar
    listaIngredientes.innerHTML = "";
    
    // Obtener el inventario del usuario actual
    const inventario = obtenerIngredientesInventario();
    console.log("Inventario obtenido:", inventario);
    
    // Convertir el objeto de inventario en un array de pares clave-valor
    const arrayInventario = Object.entries(inventario);
    
    // Iterar sobre cada ingrediente en el inventario
    arrayInventario.forEach(([nombre, cantidad]) => {
        // Crear un nuevo elemento li para el ingrediente
        const ingredienteItem = document.createElement("li");
        
        // Crear un elemento de imagen para el icono del ingrediente (suponiendo que haya una URL para el icono)
        const icono = document.createElement("img");
        icono.src = obtenerURLIcono(nombre); // Función ficticia para obtener la URL del icono
        icono.alt = nombre; // Establecer el nombre del ingrediente como texto alternativo
        
        // Crear un elemento span para la cantidad del ingrediente
        const cantidadElement = document.createElement("span");
        cantidadElement.textContent = cantidad; // Establecer la cantidad del ingrediente
        
        // Añadir el icono y la cantidad como hijos del elemento li
        ingredienteItem.appendChild(icono);
        ingredienteItem.appendChild(cantidadElement);
        
        // Añadir el elemento li a la lista de ingredientes
        listaIngredientes.appendChild(ingredienteItem);
        
       // Obtener una referencia al elemento del tooltip
        const tooltip = document.getElementById("tooltip");

        // Agregar evento para mostrar el nombre del ingrediente como tooltip al pasar el mouse sobre el icono
        icono.addEventListener("mouseover", () => {
            // Mostrar el tooltip en la posición del mouse
            tooltip.style.display = "block";
            tooltip.style.left = (event.pageX + 10) + "px"; // Posición X del tooltip
            tooltip.style.top = (event.pageY + 10) + "px"; // Posición Y del tooltip
        
        // Suponiendo que "nombre" es el nombre del ingrediente
        tooltip.textContent = icono.alt;
            console.log(icono.alt);
        });
        // Agregar evento para ocultar el tooltip cuando se retira el mouse del icono
        icono.addEventListener("mouseout", () => {
            // Ocultar el tooltip
            tooltip.style.display = "none";
            });
        });
}

// Ocultar el elemento que mostraba la lista completa de inventario
// document.getElementById("inventario-section").style.display = "none";


        function mostrarItemsCreados() {
            const itemsList = document.getElementById("lista-items-creados");
            itemsList.innerHTML = ""; // Limpiamos la lista de items creados

            itemsCreados.forEach(item => {
                const listItem = document.createElement("li");
                listItem.textContent = item;
                itemsList.appendChild(listItem);
            });
        }

        function mostrarRecetas() {
            const recetasSelect = document.getElementById("recetas");
            recetasSelect.innerHTML = ""; // Limpiamos el dropdown de recetas

            recetasConocidas.forEach(receta => {
                const option = document.createElement("option");
                option.value = receta;
                option.textContent = receta;
                recetasSelect.appendChild(option);
            });
        }

        function mostrarRecetaPersonalizada() {
            const recetaList = document.getElementById("lista-receta");
             recetaList.innerHTML = ""; // Limpiamos la lista de receta personalizada

            for (const [ingrediente, cantidad] of Object.entries(recetaPersonalizada.materiales)) {
                const listItem = document.createElement("li");
                listItem.textContent = `${ingrediente}: ${cantidad}`;
                recetaList.appendChild(listItem);
            }
        }

        function agregarIngrediente() {
    const ingredienteSeleccionado = document.getElementById("ingredientes-select").value;
    const cantidadSeleccionada = parseInt(document.getElementById("cantidad-ingredientes").value);

    if (ingredienteSeleccionado && cantidadSeleccionada > 0) {
        if (inventario[ingredienteSeleccionado] >= cantidadSeleccionada) {
            if (recetaPersonalizada.materiales.hasOwnProperty(ingredienteSeleccionado)) {
                recetaPersonalizada.materiales[ingredienteSeleccionado] += cantidadSeleccionada;
            } else {
                recetaPersonalizada.materiales[ingredienteSeleccionado] = cantidadSeleccionada;
            }
            inventario[ingredienteSeleccionado] -= cantidadSeleccionada;
           renderizarIngredientes(inventario);;
            mostrarRecetaPersonalizada();
        } else {
            agregarEvento("No tienes suficientes " + ingredienteSeleccionado + " en el inventario.");
        }
    } else {
        agregarEvento("Por favor, selecciona un ingrediente y una cantidad válida.");
    }
}

        function limpiarReceta() {
            for (const [ingrediente, cantidad] of Object.entries(recetaPersonalizada.materiales)) {
                inventario[ingrediente] += cantidad;
            }
            recetaPersonalizada.materiales = {};
           renderizarIngredientes(inventario);;
            mostrarRecetaPersonalizada();
        }

    function generarItem() {
    // Verificamos si los ingredientes seleccionados coinciden con alguna receta conocida
    const recetaCoincidente = recetas.find(receta => sonMismosIngredientes(receta, recetaPersonalizada));

    if (recetaCoincidente) {
        // Restar los ingredientes del inventario
        for (const [ingrediente, cantidad] of Object.entries(recetaCoincidente.materiales)) {
            inventario[ingrediente] -= cantidad;
        }

        // Eliminar los ingredientes del inventario que tienen una cantidad igual a cero
        for (const ingrediente in inventario) {
            if (inventario[ingrediente] === 0) {
                delete inventario[ingrediente];
            }
        }

        // Actualizar la lista de selección de ingredientes
       renderizarIngredientes(inventario);;

        const itemGenerado = recetaCoincidente.nombre;
        itemsCreados.push(itemGenerado);
        mostrarItemsCreados();

        if (!recetasConocidas.includes(itemGenerado)) {
            recetasConocidas.push(itemGenerado);
            mostrarRecetas(); // Mostramos las recetas conocidas actualizadas
        }

        alert("¡Item generado exitosamente: " + itemGenerado + "!");
        // Actualizar el inventario mostrado
       renderizarIngredientes(inventario);;
    } else {
        alert("¡No hay una receta conocida que coincida con los ingredientes seleccionados!");
    }
}

        function sonMismosIngredientes(receta1, receta2) {
            const ingredientes1 = receta1.materiales;
            const ingredientes2 = receta2.materiales;
            const keys1 = Object.keys(ingredientes1);
            const keys2 = Object.keys(ingredientes2);
            if (keys1.length !== keys2.length) return false;
            for (const key of keys1) {
                if (ingredientes1[key] !== ingredientes2[key]) return false;
            }
            return true;
        }

        let recetasProcesarIngredientes = [
    {
        nombre: "Pasta de Hierbas Curativas",
        materiales: { Agua: 1, Hierbas: 1, "Raíz de mandrágora": 1 },
        nuevoIngrediente: "Pasta de Hierbas Curativas",
        cantidadNuevoIngrediente: 1
    },
    // Puedes añadir más recetas para procesar ingredientes aquí
];

function procesarIngrediente() {
    const ingredienteSeleccionado = document.getElementById("ingredientes-select").value;
    const cantidadSeleccionada = parseInt(document.getElementById("cantidad-ingredientes").value);

    if (ingredienteSeleccionado && cantidadSeleccionada > 0) {
        const recetaCoincidente = recetasProcesarIngredientes.find(receta => sonMismosIngredientes(receta, recetaPersonalizada));

        if (recetaCoincidente) {
            const nuevoIngrediente = recetaCoincidente.nuevoIngrediente;
            const cantidadNuevoIngrediente = recetaCoincidente.cantidadNuevoIngrediente;
            
            if (nuevoIngrediente && cantidadNuevoIngrediente) {
                if (inventario.hasOwnProperty(nuevoIngrediente)) {
                    inventario[nuevoIngrediente] += cantidadNuevoIngrediente;
                } else {
                    inventario[nuevoIngrediente] = cantidadNuevoIngrediente;
                }

               renderizarIngredientes(inventario);;
                recetaPersonalizada.materiales = {};
                mostrarRecetaPersonalizada();
                alert(`¡Nuevo ingrediente "${nuevoIngrediente}" agregado al inventario!`);
            } else {
                alert("Error: La receta coincide pero no se especificó un nuevo ingrediente.");
            }
        } else {
            alert("Error: No hay una receta de procesamiento de ingredientes que coincida con los ingredientes seleccionados.");
        }
    } else {
        alert("Por favor, selecciona un ingrediente y una cantidad válida.");
    }
}

        // Función para agregar un evento al log
        function agregarEvento(evento) {
            const logList = document.getElementById("log-list");
            const listItem = document.createElement("li");
            listItem.textContent = evento;
            logList.appendChild(listItem);
        }
        // Función para obtener el usuario actual desde localStorage
        function getUsuarioActual() {
        return localStorage.getItem("usuarioActual");
        }
// Función para agregar ingredientes al inventario
 function agregarIngredientes(listaIngredientes) {
    listaIngredientes.forEach(ingrediente => {
        const nombreIngrediente = ingrediente.nombre;
        const cantidadIngrediente = ingrediente.cantidad;
        
        // Comprobamos si el ingrediente ya existe en el inventario
        if (inventario.hasOwnProperty(nombreIngrediente)) {
            inventario[nombreIngrediente] += cantidadIngrediente;
            console.log(`Agregando ingrediente: ${nombreIngrediente} Cantidad: ${cantidadIngrediente}`);
        } else {
            console.log(`El ingrediente ${nombreIngrediente} no existe en el inventario.`);
        }
    });
    console.log("Inventario actualizado:", inventario);
    renderizarIngredientes(inventario);;
}

// Eventos para los botones de agregar ingredientes
        document.getElementById("agregar-basico").addEventListener("click", function() {
            agregarIngredientes(ingredientesBasico);
        });

        document.getElementById("agregar-intermedio").addEventListener("click", function() {
            agregarIngredientes(ingredientesIntermedio);
        });

        document.getElementById("agregar-avanzado").addEventListener("click", function() {
            agregarIngredientes(ingredientesAvanzado);
        });

        
      // Evento para el botón de iniciar sesión
    document.getElementById("login-btn").addEventListener("click", function() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    const usuario = usuariosRegistrados.find(user => user.nombre === username && user.contraseña === password);
    if (usuario) {
        // Simulación de inicio de sesión exitoso
        agregarEvento("Inicio de sesión exitoso para el usuario: " + username);
        document.getElementById("inicio-sesion").style.display = "none";
        document.getElementById("guardar-localstorage-btn").style.display = "inline-block";
        document.getElementById("items-creados-section").style.display = "inline-block";
        document.getElementById("generador-section").style.display = "inline-block";
        document.getElementById("ingredientes-section").style.display = "inline-block";
        document.getElementById("agregar-inventario-section").style.display = "inline-block";
        document.getElementById("procesar-ingrediente").style.display = "inline-block"; // Mostrar el botón "Procesar Ingrediente"
        // document.getElementById("resultado").style.display = "inline-block";
        // Establecer usuario actual en localStorage
        console.log("Usuario actual establecido en localStorage:", username);
        localStorage.setItem("usuarioActual", username);
        
        // Cargar datos del usuario desde localStorage
        cargarEstadoUsuario(username);
       renderizarIngredientes(inventario);;
        // mostrarRecetaPersonalizada();
        mostrarRecetas();
        mostrarItemsCreados();
    } else {
        alert("Inicio de sesión fallido: ¡Nombre de usuario o contraseña incorrectos!");
    }
});
// Verificar si hay un usuario actual almacenado en localStorage al cargar la página
window.addEventListener("load", function() {
    const usuarioActual = getUsuarioActual();
    if (usuarioActual) {
        // Ocultar formulario de inicio de sesión y mostrar secciones relevantes
        document.getElementById("inicio-sesion").style.display = "none";
        document.getElementById("inventario-section").style.display = "inline-block";
        document.getElementById("items-creados-section").style.display = "inline-block";
        document.getElementById("generador-section").style.display = "inline-block";
        document.getElementById("ingredientes-section").style.display = "inline-block";
        document.getElementById("resultado").style.display = "inline-block";
        // Cargar datos del usuario desde localStorage
        cargarEstadoUsuario(usuarioActual);
    }
});
       // Evento para el botón de registro
document.getElementById("registro-btn").addEventListener("click", function() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    if (username && password) {
        // Verificar si el usuario ya existe
        const usuarioExistente = usuariosRegistrados.find(user => user.nombre === username);
        if (usuarioExistente) {
            agregarEvento("Registro fallido: ¡El nombre de usuario ya está en uso!");
        } else {
            // Simulación de registro exitoso
            agregarEvento("Usuario registrado exitosamente: " + username);
            document.getElementById("inicio-sesion").style.display = "none";
            document.getElementById("inventario-section").style.display = "inline-block";
            document.getElementById("items-creados-section").style.display = "inline-block";
            document.getElementById("generador-section").style.display = "inline-block";
            document.getElementById("ingredientes-section").style.display = "inline-block";
            document.getElementById("resultado").style.display = "inline-block";
            // Guardar el nombre de usuario en localStorage
            localStorage.setItem("usuarioActual", username);
            // Agregar nuevo usuario registrado a la lista
            usuariosRegistrados.push({ nombre: username, contraseña: password });
            // Guardar estado del usuario en cookies
            guardarEstadoUsuario(username);
        }
    } else {
        agregarEvento("Registro fallido: ¡Ingrese un nombre de usuario y contraseña!");
    }
});


        // Evento para el botón de agregar ingredientes de receta
        document.getElementById("agregar-ingredientes-receta").addEventListener("click", function() {
    const recetaSeleccionada = document.getElementById("recetas").value;
    const recetaEncontrada = recetas.find(receta => receta.nombre === recetaSeleccionada);

    if (recetaEncontrada) {
        let ingredientesSuficientes = true;
        for (const [ingrediente, cantidad] of Object.entries(recetaEncontrada.materiales)) {
            if (inventario[ingrediente] < cantidad) {
                ingredientesSuficientes = false;
                alert(`No tienes suficientes "${ingrediente}" en el inventario.`);
                break; // Salir del bucle si no hay suficientes ingredientes
            }
        }
        
        if (ingredientesSuficientes) {
            for (const [ingrediente, cantidad] of Object.entries(recetaEncontrada.materiales)) {
                recetaPersonalizada.materiales[ingrediente] = (recetaPersonalizada.materiales[ingrediente] || 0) + cantidad;
                inventario[ingrediente] -= cantidad;
            }
           renderizarIngredientes(inventario);;
            mostrarRecetaPersonalizada();
            agregarEvento("Ingredientes de receta agregados con éxito.");
        }
    } else {
        agregarEvento("Error: Receta seleccionada no encontrada.");
    }
});


        // Evento para el botón de generar item
        document.getElementById("generar-item").addEventListener("click", generarItem);

        // Evento para el botón de agregar ingrediente a la receta personalizada
        document.getElementById("agregar-ingrediente").addEventListener("click", agregarIngrediente);

        // Evento para el botón de limpiar receta personalizada
        document.getElementById("limpiar-receta").addEventListener("click", limpiarReceta);

      // Función para guardar el estado del usuario en localStorage
    function guardarEstadoUsuario(username) {
    localStorage.setItem(username + "-itemsCreados", JSON.stringify(itemsCreados)); // Guardar items creados
    localStorage.setItem(username + "-inventario", JSON.stringify(inventario)); // Guardar estado del inventario
    localStorage.setItem("usuariosRegistrados", JSON.stringify(usuariosRegistrados)); // Guardar usuarios registrados
    localStorage.setItem("usuarioActual", username); // Guardar usuario actual
    localStorage.setItem(username + "-recetasProcesarIngredientes", JSON.stringify(recetasProcesarIngredientes)); // Guardar recetas de procesar ingredientes
}


        document.getElementById("procesar-ingrediente").addEventListener("click", procesarIngrediente);
        
       // Función para cargar el estado del usuario desde localStorage
function cargarEstadoUsuario(username) {
            const inventarioLocalStorage = localStorage.getItem(username + "-inventario");
            if (inventarioLocalStorage) {
                inventario = JSON.parse(inventarioLocalStorage);
            }

            const itemsCreadosLocalStorage = localStorage.getItem(username + "-itemsCreados");
            if (itemsCreadosLocalStorage) {
                itemsCreados = JSON.parse(itemsCreadosLocalStorage);
            }

            const recetasConocidasLocalStorage = localStorage.getItem(username + "-recetasConocidas");
            if (recetasConocidasLocalStorage) {
                recetasConocidas = JSON.parse(recetasConocidasLocalStorage);
            }
    const recetasProcesarIngredientesLocalStorage = localStorage.getItem(username + "-recetasProcesarIngredientes"); // Cargar recetas de procesar ingredientes
    if (recetasProcesarIngredientesLocalStorage) {
        recetasProcesarIngredientes = JSON.parse(recetasProcesarIngredientesLocalStorage);
    }
        }

        // Función para guardar el estado del usuario en localStorage
        function guardarEstadoUsuario(username) {
            localStorage.setItem(username + "-inventario", JSON.stringify(inventario));
            localStorage.setItem(username + "-itemsCreados", JSON.stringify(itemsCreados));
            localStorage.setItem(username + "-recetasConocidas", JSON.stringify(recetasConocidas));
        }

        
// Evento para el botón de guardar información en localStorage
document.getElementById("guardar-localstorage-btn").addEventListener("click", function() {
    const username = localStorage.getItem("usuarioActual");
    if (username) {
        guardarEstadoUsuario(username);
        alert("¡Información guardada en localStorage!");
    } else {
        alert("No hay usuario actualmente iniciado sesión.");
    }
});
        // Función para obtener el nombre de usuario actual
        function getUsuarioActual() {
            return document.getElementById("username").value;
        }

        // Mostrar recetas iniciales
        mostrarRecetas();

    </script>
</body>
</html>
