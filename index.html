<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Post-its Digitales Avanzados</title>
<style>
  html, body {
    margin:0; padding:0; width:100%; height:100%;
    overflow:hidden; font-family: Arial, sans-serif;
  }
  #note-container {
    position: relative; width:100%; height:100%;
    background:#f0f0f0; overflow:hidden;
  }
  #newNoteBtn {
    position:absolute; top:10px; left:10px;
    z-index:1000; padding:8px 12px;
    background:#3182ce; color:#fff;
    border:none; border-radius:6px; cursor:pointer;
  }

  .note {
    position:absolute; width:220px; min-height:180px;
    border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.12);
    resize:both; overflow:auto; display:flex; flex-direction:column;
    user-select:none; padding:4px; box-sizing:border-box;
  }

  .drag-handle{ width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; font-weight:bold; cursor:grab; }

  /* colores por tipo */
  .tipo-nota{ background:#fff9a6; }
  .tipo-recordatorio{ background:#c6f6d5; }
  .tipo-mensaje{ background:#bee3f8; }
  .tipo-importante{ background:#feb2b2; }
  .tipo-lista{ background:#ffffff; border:1px solid #ccc; }

  .note-header{
    display:flex; justify-content:space-between; align-items:center;
    cursor:grab; padding:2px 4px;
  }
  .note-header .title{ font-weight:bold; flex:1; outline:none; }
  .note-header button{ margin-left:2px; cursor:pointer; }

  .note-toolbar{ display:flex; gap:4px; padding:2px 4px; border-top:1px solid rgba(0,0,0,0.1); }
  .note-toolbar button{ cursor:pointer; }

  .note-body{ flex:1; padding:4px; overflow:auto; outline:none; }
  .note-body[style-type="title"]{ font-size:16px; font-weight:bold; }
  .note-body[style-type="subtitle"]{ font-size:14px; font-weight:bold; }
  .note-body[style-type="body"]{ font-size:12px; font-weight:normal; }

  .context-menu{
    position:absolute; display:none; background:white; border:1px solid #ccc;
    box-shadow:2px 2px 6px rgba(0,0,0,0.2); z-index:9999;
  }
  .context-menu ul{ list-style:none; margin:0; padding:5px 0; }
  .context-menu ul li{ padding:5px 10px; cursor:pointer; white-space:nowrap; }
  .context-menu ul li:hover{ background:#eee; }
</style>
</head>
<body>
<button id="newNoteBtn">‚ûï Nueva nota</button>
<div id="note-container"></div>

<div class="context-menu" id="contextMenu">
  <ul>
    <li data-type="nota">üìù Nota</li>
    <li data-type="recordatorio">‚è∞ Recordatorio</li>
    <li data-type="mensaje">üí¨ Mensaje</li>
    <li data-type="importante">üî¥ Importante</li>
    <li data-type="lista">üìã Lista</li>
  </ul>
</div>

<script>
const container = document.getElementById('note-container');
const newBtn = document.getElementById('newNoteBtn');
const contextMenu = document.getElementById('contextMenu');
let zIndexCounter = 100;
let dragged = null;
let dragOffset = {x:0,y:0};
let currentContextNote = null;

/* --- DRAG GLOBAL --- */
document.addEventListener('mousemove', e=>{
  if(!dragged) return;
  dragged.style.left = (e.clientX - dragOffset.x)+'px';
  dragged.style.top  = (e.clientY - dragOffset.y)+'px';
});
document.addEventListener('mouseup', ()=>{ dragged=null; saveNotes(); });

/* --- CONTEXT MENU --- */
document.addEventListener('click', e=>{
  if(contextMenu.style.display==='block' && !contextMenu.contains(e.target)){
    contextMenu.style.display='none';
    currentContextNote=null;
  }
});
contextMenu.addEventListener('click', e=>{
  const li = e.target.closest('li[data-type]');
  if(li && currentContextNote){
    applyType(currentContextNote, li.dataset.type);
    contextMenu.style.display='none';
    currentContextNote=null;
    saveNotes();
  }
});

/* --- UTILIDADES --- */
function applyType(note,type){
  note.classList.remove('tipo-nota','tipo-recordatorio','tipo-mensaje','tipo-importante','tipo-lista');
  note.classList.add('tipo-'+type);
  const t=note.querySelector('.title');
  const generic=['T√≠tulo','Nota','Recordatorio','Mensaje','Importante','Lista',''];
  if(generic.includes(t.innerText)) t.innerText=type.charAt(0).toUpperCase()+type.slice(1);
}

/* --- CREAR NOTA --- */
function createNote(data={}){
  const note = document.createElement('div');
  const type = data.type || 'nota';
  note.className='note tipo-'+type;
  note.style.left=data.left||'50px';
  note.style.top=data.top||'50px';
  note.style.width=data.width||'220px';
  note.style.height=data.height||'180px';
  note.style.zIndex=++zIndexCounter;

  // HEADER
  const handle = document.createElement('div'); handle.className='drag-handle'; handle.textContent='‚â°';
  const header=document.createElement('div'); header.className='note-header';
  const title=document.createElement('div'); title.className='title'; title.contentEditable=true;
  title.innerText=data.title||'T√≠tulo';
  const btnDel=document.createElement('button'); btnDel.innerText='‚úñ';
  btnDel.addEventListener('click', e=>{ e.stopPropagation(); note.remove(); saveNotes(); });
  const btnMenu=document.createElement('button'); btnMenu.innerText='‚ãØ';
  btnMenu.addEventListener('click', e=>{
    e.stopPropagation();
    currentContextNote=note;
    showContextMenu(e.pageX,e.pageY);
  });
  header.append(handle, title, btnMenu, btnDel);
  header.addEventListener('mousedown', e=>{
    if([title, btnMenu, btnDel].includes(e.target)) return;
    dragged=note;
    dragOffset.x=e.clientX-note.offsetLeft;
    dragOffset.y=e.clientY-note.offsetTop;
    note.style.zIndex=++zIndexCounter;
  });

  // TOOLBAR FORMATO
  const toolbar=document.createElement('div'); toolbar.className='note-toolbar';
  let fontSize = 14; // siempre inicia en 14px
  const btnMinus=document.createElement('button'); btnMinus.innerText='-';
  const sizeDisplay=document.createElement('span'); sizeDisplay.innerText=fontSize+'px';
  const btnPlus=document.createElement('button'); btnPlus.innerText='+';

  btnMinus.addEventListener('click', ()=>{
    fontSize = Math.max(8, fontSize-2);
    document.execCommand("fontSize", false, "7");
    updateFontSize(fontSize);
  });
  btnPlus.addEventListener('click', ()=>{
    fontSize = Math.min(48, fontSize+2);
    document.execCommand("fontSize", false, "7");
    updateFontSize(fontSize);
  });

  function updateFontSize(px){
    const fontElements = document.getElementsByTagName("font");
    for(let i=0;i<fontElements.length;i++){
      if(fontElements[i].size=="7"){
        fontElements[i].removeAttribute("size");
        fontElements[i].style.fontSize=px+"px";
      }
    }
    sizeDisplay.innerText=px+"px";
  }

  const btnB=document.createElement('button'); btnB.innerText='B';
  btnB.onclick=()=>document.execCommand('bold');
  const btnI=document.createElement('button'); btnI.innerText='I';
  btnI.onclick=()=>document.execCommand('italic');

  toolbar.append(btnMinus, sizeDisplay, btnPlus, btnB, btnI);

  // BODY
  const body=document.createElement('div'); body.className='note-body'; body.contentEditable=true;
  body.setAttribute('style-type', 'body');
  body.innerText=data.content||'Escribe aqu√≠...';
  body.addEventListener('input', ()=>saveNotes());

  note.append(header, toolbar, body);
  container.appendChild(note);
  return note;
}

/* --- NUEVA NOTA --- */
newBtn.addEventListener('click', ()=>{ createNote(); saveNotes(); });

/* --- MENU CONTEXTUAL --- */
function showContextMenu(x,y){
  contextMenu.style.left=x+'px';
  contextMenu.style.top=y+'px';
  contextMenu.style.display='block';
}

/* --- GUARDADO Y CARGADO --- */
function saveNotes(){
  const arr=[];
  container.querySelectorAll('.note').forEach(n=>{
    arr.push({
      type:Array.from(n.classList).find(c=>c.startsWith('tipo-'))?.replace('tipo-','')||'nota',
      left:n.style.left,
      top:n.style.top,
      width:n.style.width,
      height:n.style.height,
      title:n.querySelector('.title')?.innerText||'',
      content:n.querySelector('.note-body')?.innerText||''
    });
  });
  localStorage.setItem('notes', JSON.stringify(arr));
}

function loadNotes(){
  const data=JSON.parse(localStorage.getItem('notes')||'[]');
  data.forEach(d=>createNote(d));
}

window.addEventListener('load', loadNotes);
</script>
</body>
</html>
