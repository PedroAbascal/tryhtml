<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jacquard+24&display=swap" rel="stylesheet">

    
    <title>Generador de Items y Pociones de D&D 5e</title>
    <style>
        /* Estilos CSS pueden ser añadidos aquí */
        body {
            /* Imagen de fondo */
            background-image: url(https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/an_alchemist_workshop_by_ai_postcards_dfhoy48-fullview.jpg);
            background-size: cover; /* Para cubrir todo el fondo */
            background-repeat: no-repeat; /* Para que la imagen no se repita */
            background-attachment: fixed; /* Para fijar la imagen mientras se desplaza la página */

            /* CSS */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: rgba(252, 190, 43, 0.5); /* Amarillo anaranjado con una transparencia del 50% */
            padding: 10px; /* Añade un espacio alrededor del texto para que el fondo sea visible */
            border-radius: 5px; /* Para suavizar los bordes del fondo */
        }

        .section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

            .jacquard-24-regular {
              font-family: "Jacquard 24", system-ui;
              font-weight: 400;
              font-style: normal;
                                }
        
            h1, h2, h3, h4, h5  
        {
            font-family: "Jacquard 24", system-ui; /* Aplica la fuente */
            background-color: rgba(252, 190, 43, 0.5);
            padding: 5px; /* Añade un espacio alrededor del texto para que el fondo sea visible */
            border-radius: 3px; /* Para suavizar los bordes del fondo */
            color: 	#000000; /* Cambiar el color del texto */
            margin-bottom: 5px;
            margin-top: 5px;
            
        }
        
        h6
        {
            font-family: "Jacquard 24", system-ui; /* Aplica la fuente */
            background-color: rgba(252, 190, 43, 0.5);
            color: 	#000000; /* Cambiar el color del texto */
            margin-bottom: 1px;
            margin-top: 1px;
        }
        
        .section > * {
            margin-bottom: 10px;
        }

        .multi-column-list {
            column-count: 5; /* Divide la lista en x columnas */
            column-gap: 30px; /* Espacio entre las columnas */
            list-style-type: none; /* Elimina los puntos de la lista */
        }

        #lista-ingredientes{
            font-family: "Jacquard 24", system-ui;
            color: 	#000000;
            font-size: 28px;
            list-style-type: none;
            
        }
        
        #inicio-sesion {
            display: block;
        }   

        #inventario-section,
        #items-creados-section,
        #generador-section,
        #ingredientes-section,
        #event-log,
        #agregar-inventario-section,
        #guardar-localstorage-btn {
            display: none;
        }
    </style>
</head>
<body>
    
    <div class="container">
        
        <!-- Agrega un elemento div con un ID específico para el tooltip -->
        <div id="tooltip" style="position: absolute; display: none; background-color: rgba(0, 0, 0, 0.7); color: white; padding: 5px; border-radius: 5px;"></div>
        
        <h1>Generador de Items y Pociones de D&D 5e</h1>

        <!-- Inicio de Sesión -->
        <div id="inicio-sesion" class="section">
            <h2>Iniciar Sesión</h2>
            <label for="username">Nombre de Usuario:</label>
            <input type="text" id="username">
            <label for="password">Contraseña:</label>
            <input type="password" id="password">
            <button id="login-btn">Iniciar Sesión</button>
            <button id="registro-btn">Registrarse</button>
        </div>

        <!-- Botón Guardar Estado -->
        <div class="section">
            <button id="guardar-localstorage-btn" >Guardar Estado</button>
        </div>

        <!-- Lista de Items Creados -->
        <div id="items-creados-section" class="section">
            <h2>Items Creados</h2>
            <ul id="lista-items-creados">
                <!-- Aquí se mostrarán los items creados -->
            </ul>
        </div>

        <!-- Seleccionar Receta, Agregar Ingredientes de Receta y Generar Item -->
        <div id="generador-section" class="section">
    <label for="recetas">Selecciona una receta:</label>
    <select id="recetas">
        <!-- Las opciones serán agregadas dinámicamente -->
    </select>
    <button id="agregar-ingredientes-receta">Agregar Ingredientes de Receta</button>
    <button id="generar-item">Generar Item</button>
    <button id="procesar-ingrediente">Procesar Ingrediente</button>
</div>

        <!-- Seleccionar un Ingrediente, Selector de Cantidad, Agregar Ingrediente y Limpiar Receta -->
        <div id="ingredientes-section" class="section">
            <h2>Selecciona un ingrediente</h2>
            <ul id="lista-receta" class="ingredientes-lista" style="height: 100px; width: 100px ;background-image: url(https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Empty-Cauldron-With-White-Background-76941306-1.png); background-size: cover; padding: 10px; border-radius: 5px; "></ul>
            <ul id="lista-ingredientes"  class="ingredientes-lista" style= "max-height: 200px; overflow: auto; " >
        <!-- class="multi-column-list"  -->
    </ul>
            <input type="number" id="cantidad-ingredientes" value="1" min="1">
            <button id="agregar-ingrediente">Agregar Ingrediente</button>
            <button id="limpiar-receta">Limpiar Receta</button>
        </div>

        <!-- Botones para Agregar Ingredientes Básicos, Intermedios y Avanzados -->
        <div id="agregar-inventario-section" class="section">
            <h2>Agregar Ingredientes al Inventario</h2>
            <button id="agregar-basico">Agregar Ingredientes Básicos</button>
            <button id="agregar-intermedio">Agregar Ingredientes Intermedios</button>
            <button id="agregar-avanzado">Agregar Ingredientes Avanzados</button>
        </div>

        <!-- Log de Eventos -->
        <div id="event-log" class="section">
            <h2>Eventos</h2>
            <ul id="log-list">
                <!-- Aquí se mostrarán los eventos -->
            </ul>
        </div>
    
    </div>

    <script>
        // JavaScript puede ser añadido aquí
        let usuariosRegistrados = [
            { nombre: "usuario1", contraseña: "usuario1" },
            { nombre: "usuario2", contraseña: "usuario2" },
            { nombre: "usuario3", contraseña: "usuario3" },
            { nombre: "usuario4", contraseña: "usuario4" },
            { nombre: "usuario5", contraseña: "usuario5" }
        ];
        let recetasConocidas = [];
        let recetasMortero = [];
        let recetas = [
            { nombre: "Poción de curación menor", materiales: { Agua: 1, "Hojas de salvia": 1, "Raíz de mandrágora": 1 }, efecto: "Cura 1d4 + 1 puntos de golpe." },
            { nombre: "Poción de curación", materiales: { "Agua de manantial": 1, "Pasta de Hierbas Curativas": 1, "Raíz de mandrágora": 1 }, efecto: "Cura 2d4 + 2 puntos de golpe." },
            { nombre: "Poción de curación mayor", materiales: { "Rocío de la mañana": 1, "Pasta de Hierbas Curativas": 1, "Raíz de mandrágora": 1 }, efecto: "Cura 4d4 + 4 puntos de golpe." },
            { nombre: "Espada larga", materiales: { Metal: 2, Madera: 1 }, efecto: "Arma cuerpo a cuerpo que causa 1d8 de daño cortante." },
            // Puedes añadir más recetas aquí
            {
        nombre: "Poción de curación",
        materiales: { "Néctar de flores": 1, "Escamas de pez": 1, "Polen de abeja": 1 },
        efecto: "Cura 2d4 + 2 puntos de golpe."
    },
    {
        nombre: "Espada de élfica",
        materiales: { "Orejas de elfo": 2, "Pluma de cuervo": 1, "Escamas de dragón bebé": 1 },
        efecto: "Arma cuerpo a cuerpo que causa 1d8 de daño cortante."
    },
    {
        nombre: "Poción de velocidad",
        materiales: { "Polvo de hada": 1, "Savia de árbol antiguo": 1, "Piedra de luna": 1 },
        efecto: "Aumenta la velocidad de movimiento en 30 pies durante 1 hora."
    },
    {
        nombre: "Piedra de fuego",
        materiales: { "Lágrimas de fénix": 1, "Esencia de estrella": 1, "Sangre de titán": 1 },
        efecto: "Al lanzarla al suelo, crea una explosión de fuego en un radio de 20 pies."
    },
    {
        nombre: "Armadura de titán",
        materiales: { "Residuo de meteorito": 5, "Piedra de alma": 1, "Escencia de dragón antiguo": 1 },
        efecto: "Armadura que otorga resistencia a todos los daños y aumenta la fuerza en 2 puntos."
    },
    // Agrega más recetas aquí si es necesario
    {
        nombre: "Elixir de invisibilidad",
        materiales: { "Polvo de invisibilidad": 1, "Lágrimas de sombra": 1, "Pluma de murciélago": 1 },
        efecto: "Te vuelve invisible durante 1 hora."
    },
    {
        nombre: "Arco del cazador",
        materiales: { "Cuerno de ciervo": 2, "Pelo de lobo": 1, "Pluma de águila": 1 },
        efecto: "Arco que causa daño extra a criaturas bestiales."
    },
    {
        nombre: "Poción de resistencia",
        materiales: { "Fluido de resistencia": 1, "Planta de vigor": 1, "Escarabajo endurecido": 1 },
        efecto: "Aumenta la resistencia a daño durante 1 hora."
    },
    {
        nombre: "Gema de teletransporte",
        materiales: { "Cristal de cuarzo": 1, "Pluma de ave migratoria": 1, "Energía astral": 1 },
        efecto: "Te teletransporta a un lugar conocido."
    },
    {
        nombre: "Capa de camuflaje",
        materiales: { "Pieles de camaleón": 2, "Hilo de araña": 1, "Planta mimética": 1 },
        efecto: "Te permite camuflarte en tu entorno."
    },
    // Agrega más recetas aquí si es necesario
];

let recetasProcesarIngredientes = [
    {nombre: "Pasta de Hierbas Curativas", materiales: { Agua: 1, "Hojas de salvia": 1, "Raíz de mandrágora": 1 }, nuevoIngrediente: "Pasta de Hierbas Curativas", cantidadNuevoIngrediente: 1, categoriaNuevoIngrediente: "Medicinal"},
    {nombre: "Polvo de raíz de mandragora", materiales: { "Raíz de mandrágora": 3 }, nuevoIngrediente: "Polvo de raíz de mandragora", cantidadNuevoIngrediente: 1, categoriaNuevoIngrediente: "Medicinal"},
    // Puedes añadir más recetas para procesar ingredientes aquí
];
        
        let recetaPersonalizada = {
            nombre: "Receta personalizada",
            materiales: {}
        };
        let inventario = {
   "Agua": { cantidad: 10, categoria: "Liquido" },
    "Hojas de salvia": { cantidad: 5, categoria: "Vegetal" },
    "Raíz de mandrágora": { cantidad: 3, categoria: "Vegetal" },
    "Metal": { cantidad: 0, categoria: "Metálico" },
    "Madera": { cantidad: 0, categoria: "Vegetal" },
    "Oro": { cantidad: 0, categoria: "Metálico" },
    "Diamante": { cantidad: 0, categoria: "Cristalino" },
    "Néctar de flores": { cantidad: 0, categoria: "Vegetal" },
    "Escamas de pez": { cantidad: 0, categoria: "Animal" },
    "Polen de abeja": { cantidad: 0, categoria: "Vegetal" },
    "Pulpa de frutas": { cantidad: 0, categoria: "Vegetal" },
    "Tierra fértil": { cantidad: 0, categoria: "Vegetal" }, // icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons_27_58.png" , humedad: 10, neutro: 10, veneno: 0, curacion: 0, magia: 0, atributo: "Sabiduría", efecto_magico: "Antilevitación", ph: 4, nutricion: 0, dominio: "Terrenal", rareza: 1},
    "Musgo fresco": { cantidad: 0, categoria: "Vegetal" },
    "Agua de manantial": { cantidad: 0, categoria: "Liquido" },
    "Pluma de cuervo": { cantidad: 0, categoria: "Animal" },
    "Hojas de menta": { cantidad: 0, categoria: "Vegetal" },
    "Rocío de la mañana": { cantidad: 0, categoria: "Liquido" },
    "Alas de mariposa": { cantidad: 0, categoria: "Animal" },
    "Corteza de árbol": { cantidad: 0, categoria: "Vegetal" },
    "Pétalos de rosa": { cantidad: 0, categoria: "Vegetal" },
    "Semillas de girasol": { cantidad: 0, categoria: "Vegetal" },
    "Azúcar de caña": { cantidad: 0, categoria: "Vegetal" },
    "Raíz de jengibre": { cantidad: 0, categoria: "Vegetal" },
    "Granos de café": { cantidad: 0, categoria: "Vegetal" },
    "Canela molida": { cantidad: 0, categoria: "Vegetal" },
    "Pimienta negra": { cantidad: 0, categoria: "Vegetal" },
    "Miel silvestre": { cantidad: 0, categoria: "Vegetal" },
    "Nuez moscada": { cantidad: 0, categoria: "Vegetal" },
    "Sal marina": { cantidad: 0, categoria: "Vegetal" },
    "Aceite de oliva": { cantidad: 0, categoria: "Vegetal" },
    "Jugo de limón": { cantidad: 0, categoria: "Liquido" },
    "Vinagre de sidra de manzana": { cantidad: 0, categoria: "Liquido" },
    "Menta fresca": { cantidad: 0, categoria: "Vegetal" },
    "Ajo triturado": { cantidad: 0, categoria: "Vegetal" },
    "Cebolla picada": { cantidad: 0, categoria: "Vegetal" },
    "Perejil fresco": { cantidad: 0, categoria: "Vegetal" },
    "Tomillo seco": { cantidad: 0, categoria: "Vegetal" },
    "Albahaca fresca": { cantidad: 0, categoria: "Vegetal" },
    "Cilantro picado": { cantidad: 0, categoria: "Vegetal" },
    "Orégano seco": { cantidad: 0, categoria: "Vegetal" },
    "Romero fresco": { cantidad: 0, categoria: "Vegetal" },
    "Salsa de soja": { cantidad: 0, categoria: "Liquido" },
    "Salsa Worcestershire": { cantidad: 0, categoria: "Liquido" },
    "Mostaza Dijon": { cantidad: 0, categoria: "Vegetal" },
    "Salsa de tomate": { cantidad: 0, categoria: "Liquido" },
    "Crema de leche": { cantidad: 0, categoria: "Liquido" },
    "Mantequilla derretida": { cantidad: 0, categoria: "Liquido" },
    "Huevos frescos": { cantidad: 0, categoria: "Animal" },
    "Leche de almendra": { cantidad: 0, categoria: "Liquido" },
    "Leche de coco": { cantidad: 0, categoria: "Liquido" },
    "Yogur natural": { cantidad: 0, categoria: "Liquido" },
    "Queso rallado": { cantidad: 0, categoria: "Vegetal" },
    "Pan rallado": { cantidad: 0, categoria: "Vegetal" },
    "Harina de trigo": { cantidad: 0, categoria: "Vegetal" },
    "Harina de maíz": { cantidad: 0, categoria: "Vegetal" },
    "Levadura en polvo": { cantidad: 0, categoria: "Vegetal" },
    "Azúcar glass": { cantidad: 0, categoria: "Vegetal" },
    "Orejas de elfo": { cantidad: 0, categoria: "Animal" },
    "Escamas de dragón bebé": { cantidad: 0, categoria: "Animal" },
    "Polvo de hada": { cantidad: 0, categoria: "Magico" },
    "Savia de árbol antiguo": { cantidad: 0, categoria: "Vegetal" },
    "Piedra de luna": { cantidad: 0, categoria: "Cristalino" },
    "Lengua de basilisco": { cantidad: 0, categoria: "Animal" },
    "Escamas de salamandra": { cantidad: 0, categoria: "Animal" },
    "Ojo de gato": { cantidad: 0, categoria: "Animal" },
    "Colmillo de lobo": { cantidad: 0, categoria: "Animal" },
    "Garra de oso": { cantidad: 0, categoria: "Animal" },
    "Pluma de fénix": { cantidad: 0, categoria: "Animal" },
    "Escama de dragón adulto": { cantidad: 0, categoria: "Animal" },
    "Cuerno de unicornio": { cantidad: 0, categoria: "Animal" },
    "Garra de grifo": { cantidad: 0, categoria: "Animal" },
    "Pelaje de lince": { cantidad: 0, categoria: "Animal" },
    "Piel de serpiente": { cantidad: 0, categoria: "Animal" },
    "Espina de gorgona": { cantidad: 0, categoria: "Animal" },
    "Sangre de vampiro": { cantidad: 0, categoria: "Animal" },
    "Hueso de esqueleto": { cantidad: 0, categoria: "Animal" },
    "Escamas de tritón": { cantidad: 0, categoria: "Animal" },
    "Púa de erizo": { cantidad: 0, categoria: "Animal" },
    "Garra de águila": { cantidad: 0, categoria: "Animal" },
    "Colmillo de tigre": { cantidad: 0, categoria: "Animal" },
    "Sangre de ogro": { cantidad: 0, categoria: "Animal" },
    "Escamas de quimera": { cantidad: 0, categoria: "Animal" },
    "Hueso de gigante": { cantidad: 0, categoria: "Animal" },
    "Pluma de cuervo gigante": { cantidad: 0, categoria: "Animal" },
    "Lengua de lince": { cantidad: 0, categoria: "Animal" },
    "Ojo de orco": { cantidad: 0, categoria: "Animal" },
    "Púa de armadillo": { cantidad: 0, categoria: "Animal" },
    "Escama de dragón anciano": { cantidad: 0, categoria: "Animal" },
    "Pelo de lobo de las sombras": { cantidad: 0, categoria: "Animal" },
    "Hueso de manticora": { cantidad: 0, categoria: "Animal" },
    "Hilo de araña gigante": { cantidad: 0, categoria: "Animal" },
    "Colmillo de jabalí": { cantidad: 0, categoria: "Animal" },
    "Escamas de kraken": { cantidad: 0, categoria: "Animal" },
    "Colmillo de oso polar": { cantidad: 0, categoria: "Animal" },
    "Sangre de demonio": { cantidad: 0, categoria: "Animal" },
    "Diente de tiburón": { cantidad: 0, categoria: "Animal" },
    "Cuerno de minotauro": { cantidad: 0, categoria: "Animal" },
    "Garra de grifo": { cantidad: 0, categoria: "Animal" },
    "Colmillo de dragón rojo": { cantidad: 0, categoria: "Animal" },
    "Sangre de titán": { cantidad: 0, categoria: "Animal" },
    "Escamas de gárgola": { cantidad: 0, categoria: "Animal" },
    "Púa de erizo": { cantidad: 0, categoria: "Animal" },
    "Colmillo de lobo huargo": { cantidad: 0, categoria: "Animal" },
    "Escamas de dragón dorado": { cantidad: 0, categoria: "Animal" },
    "Hueso de quimera": { cantidad: 0, categoria: "Animal" },
    "Pluma de grifo": { cantidad: 0, categoria: "Animal" },
    "Cuerno de unicornio negro": { cantidad: 0, categoria: "Animal" },
    "Lágrimas de fénix": { cantidad: 0, categoria: "Liquido" },
    "Esencia de estrella": { cantidad: 0, categoria: "Magico" },
    "Sangre de titán": { cantidad: 0, categoria: "Liquido" },
    "Luz de luna llena": { cantidad: 0, categoria: "Magico" },
    "Residuo de meteorito": { cantidad: 0, categoria: "Cristalino" },
    "Piedra de alma": { cantidad: 0, categoria: "Cristalino" },
    "Escencia de dragón antiguo": { cantidad: 0, categoria: "Animal" },
    "Corazón de elemental": { cantidad: 0, categoria: "Magico" },
    "Polvo de unicornio": { cantidad: 0, categoria: "Animal" },
    "Aura de hada": { cantidad: 0, categoria: "Magico" },
    "Pluma de ángel": { cantidad: 0, categoria: "Animal" },
    "Lágrimas de dios": { cantidad: 0, categoria: "Magico" },
    "Símbolo de divinidad": { cantidad: 0, categoria: "Magico" },
    "Resplandor de aurora": { cantidad: 0, categoria: "Magico" },
    "Esencia de esfinge": { cantidad: 0, categoria: "Magico" },
    "Polvo de sueños": { cantidad: 0, categoria: "Magico" },
    "Gema de almas": { cantidad: 0, categoria: "Magico" },
    "Escama de dragón cromático": { cantidad: 0, categoria: "Animal" },
    "Ceniza de fénix": { cantidad: 0, categoria: "Animal" },
    "Pasta de Hierbas Curativas": { cantidad: 0, categoria: "Medicinal" },
    "Polvo de raíz de mandragora": { cantidad: 0, categoria: "Medicinal" }
};

const ingredientesBasico = [
    { nombre: "Agua", cantidad: 5, categoria: "Liquido", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_30_50.png" , humedad: 10, neutro: 20, veneno: 0, curacion: 0, magia: 0, atributo: "Constitución", efecto_magico: "Ninguno", ph: 5, nutricion: 0, dominio: "Terrenal", rareza: 1},
    { nombre: "Hojas de salvia", cantidad: 5, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_29_76.png" , humedad: 3, neutro: 5, veneno: 6, curacion: 7, magia: 1, atributo: "Constitución", efecto_magico: "Calma", ph: 12, nutricion: 1, dominio: "Terrenal", rareza: 1 },
    { nombre: "Raíz de mandrágora", cantidad: 5, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_29_71.png", humedad: 6, neutro: 1, veneno: 5, curacion: 10, magia: 7, atributo: "HP", efecto_magico: "Parálisis", ph: 7, nutricion: -15, dominio: "Terrenal", rareza: 7},
    { nombre: "Néctar de flores", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_29_42.png" , humedad: 7, neutro: 10, veneno: 0, curacion: 2, magia: 0, atributo: "Destreza", efecto_magico: "Risas", ph: 9, nutricion: 5, dominio: "Terrenal", rareza: 3},
    { nombre: "Escamas de pez", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_29_94.png", humedad: 1, neutro: 7, veneno: 2, curacion: 0, magia: 1, atributo: "Inteligencia", efecto_magico: "Respiración Acuatica", ph: 7, nutricion: -5, dominio: "Terrenal", rareza: 1 },
    { nombre: "Polen de abeja", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Icons_27_88.png", humedad: 1, neutro: 5, veneno: 0, curacion: 1, magia: 1, atributo: "Sabiduría", efecto_magico: "Parálisis", ph: 3, nutricion: 10, dominio: "Terrenal", rareza: 3 },
    { nombre: "Pulpa de frutas", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_28_14.png" , humedad: 6, neutro: 7, veneno: 0, curacion: 2, magia: 0, atributo: "Constitución", efecto_magico: "Curación", ph: 7, nutricion: 25, dominio: "Terrenal", rareza: 1},
    { nombre: "Tierra fértil", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons_27_58.png" , humedad: 10, neutro: 10, veneno: 0, curacion: 0, magia: 0, atributo: "Sabiduría", efecto_magico: "Antilevitación", ph: 4, nutricion: 0, dominio: "Terrenal", rareza: 1},
    { nombre: "Musgo fresco", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_28_100.png" , humedad: 2, neutro: 5, veneno: 7, curacion: 2, magia: 2, atributo: "Agilidad", efecto_magico: "Fuerza", ph: 12, nutricion: 0, dominio: "Terrenal", rareza: 1},
    { nombre: "Agua de manantial", cantidad: 50, categoria: "Liquido", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_29_06.png", humedad: 10, neutro: 15, veneno: 0, curacion: 0, magia: 2, atributo: "Constitución", efecto_magico: "Ninguno", ph: 7, nutricion: 0, dominio: "Terrenal", rareza: 2},
    { nombre: "Pluma de cuervo", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_29_34.png" , humedad: 1, neutro: 7, veneno: 3, curacion: 0, magia: 4, atributo: "Agilidad", efecto_magico: "Levitación", ph: 7, nutricion: 0, dominio: "Terrenal", rareza: 3},
    { nombre: "Hojas de menta", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_29_18.png" , humedad: 6, neutro: 12, veneno: 1, curacion: 2, magia: 1, atributo: "Fuerza", efecto_magico: "Catalizador", ph: 9, nutricion: 2, dominio: "Terrenal", rareza: 1},
    { nombre: "Metal", cantidad: 30, categoria: "Metálico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Icons_27_44.png" , humedad: 1, neutro: 5, veneno: 6, curacion: 0, magia: 1, atributo: "Fuerza", efecto_magico: "Catalizador", ph: 5, nutricion: 0, dominio: "Terrenal", rareza: 1},
    { nombre: "Madera", cantidad: 30, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Icons_27_31.png"  , humedad: 5, neutro: 5, veneno: 3, curacion: 1, magia: 2, atributo: "Carisma", efecto_magico: "Catalizador", ph: 5, nutricion: 0, dominio: "Terrenal", rareza: 1}
];

const ingredientesIntermedio = [
    { nombre: "Rocío de la mañana", cantidad: 50, categoria: "Liquido", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_29_06.png" },    
    { nombre: "Orejas de elfo", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_29_63.png" },
    { nombre: "Escamas de dragón bebé", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Icons_27_82.png" },
    { nombre: "Polvo de hada", cantidad: 50, categoria: "Magico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_27_98.png" },
    { nombre: "Savia de árbol antiguo", cantidad: 50, categoria: "Vegetal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Icons_27_55.png" },
    { nombre: "Piedra de luna", cantidad: 50, categoria: "Cristalino", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Icons_27_81.png" },
    { nombre: "Lengua de basilisco", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_29_11.png" },
    { nombre: "Escamas de salamandra", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Icons_27_62.png" },
    { nombre: "Ojo de gato", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_28_23.png" },
    { nombre: "Colmillo de lobo", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_28_24.png" },
    { nombre: "Garra de oso", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_28_25.png" },
    { nombre: "Pasta de Hierbas Curativas", cantidad: 0, categoria: "Medicinal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_28_100.png" },
    { nombre: "Polvo de raíz de mandragora", cantidad: 0, categoria: "Medicinal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_28_89.png" }
    
    
];

const ingredientesAvanzado = [
    { nombre: "Oro", cantidad: 15, categoria: "Metálico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Icons_27_54.png" },
    { nombre: "Diamante", cantidad: 15, categoria: "Cristalino", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/26.png" },
    { nombre: "Lágrimas de fénix", cantidad: 50, categoria: "Liquido", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/30.png" },
    { nombre: "Esencia de estrella", cantidad: 50, categoria: "Magico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Sangre de titán", cantidad: 50, categoria: "Liquido", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Luz de luna llena", cantidad: 50, categoria: "Magico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Residuo de meteorito", cantidad: 50, categoria: "Cristalino", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Piedra de alma", cantidad: 50, categoria: "Cristalino", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Escencia de dragón antiguo", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Corazón de elemental", cantidad: 50, categoria: "Magico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Polvo de unicornio", cantidad: 50, categoria: "Animal", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" },
    { nombre: "Aura de hada", cantidad: 50, categoria: "Magico", icono: "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Armors/Armor1/armor0.png" }
];
        let itemsCreados = [];
        let listaIngredientes;
        
        
function obtenerIngredientesInventario() {
    // Obtener el nombre de usuario actual
    const usuarioActual = getUsuarioActual();
    // Verificar si hay datos en el localStorage para el inventario del usuario actual
    const datosInventario = localStorage.getItem(`${usuarioActual}-inventario`);
    // Si hay datos en el localStorage para el inventario del usuario actual, parsearlos a un objeto JavaScriptDe lo contrario, devolver un objeto vacío
    return datosInventario ? JSON.parse(datosInventario) : {};
}

// Función para obtener la URL del icono basado en el nombre del ingrediente
function obtenerURLIcono(nombre) {
    // Buscar el nombre del ingrediente en la lista de ingredientes básicos
    const ingredienteBasico = ingredientesBasico.find(ingrediente => ingrediente.nombre === nombre);
    if (ingredienteBasico) {
        return ingredienteBasico.icono;
    }

    // Buscar el nombre del ingrediente en la lista de ingredientes intermedios
    const ingredienteIntermedio = ingredientesIntermedio.find(ingrediente => ingrediente.nombre === nombre);
    if (ingredienteIntermedio) {
        return ingredienteIntermedio.icono;
    }

    // Buscar el nombre del ingrediente en la lista de ingredientes avanzados
    const ingredienteAvanzado = ingredientesAvanzado.find(ingrediente => ingrediente.nombre === nombre);
    if (ingredienteAvanzado) {
        return ingredienteAvanzado.icono;
    }

    // Devolver null si no se encontró el nombre del ingrediente en ninguna lista
    return null;
}

function renderizarIngredientes() {
    const listaExistente = document.getElementById("lista-ingredientes");
    
    // Limpiar la lista de ingredientes existente antes de volver a renderizar
    listaExistente.innerHTML = "";

    // Objeto para almacenar los ingredientes clasificados por categoría
    const ingredientesPorCategoria = {};

    // Clasificar los ingredientes por categoría
    for (const [nombreIngrediente, infoIngrediente] of Object.entries(inventario)) {
        const cantidad = infoIngrediente.cantidad;
        const categoria = infoIngrediente.categoria;

        if (cantidad > 0) {
            // Agregar el ingrediente al array correspondiente a su categoría
            if (!ingredientesPorCategoria.hasOwnProperty(categoria)) {
                ingredientesPorCategoria[categoria] = [];
            }
            ingredientesPorCategoria[categoria].push({ nombre: nombreIngrediente, cantidad: cantidad });
        }
    }

    // Iterar sobre cada categoría y agregar los ingredientes al DOM
    for (const categoria in ingredientesPorCategoria) {
        const ingredientesCategoria = ingredientesPorCategoria[categoria];

        // Crear una nueva columna <li> para la categoría
        const columnaCategoria = document.createElement("li");
        columnaCategoria.className = "columna-categoria";

        // Crear un título para la categoría
        const tituloCategoria = document.createElement("h6");
        tituloCategoria.textContent = categoria;
        columnaCategoria.appendChild(tituloCategoria);

        // Crear una nueva lista <ul> para la categoría
        const listaCategoria = document.createElement("ul");
        listaCategoria.className = "lista-categoria";

        // Iterar sobre los ingredientes de la categoría y agregarlos como elementos <li>
        ingredientesCategoria.forEach(ingrediente => {
            const ingredienteItem = document.createElement("li");
            const icono = document.createElement("img");
            icono.src = obtenerURLIcono(ingrediente.nombre);
            icono.alt = ingrediente.nombre;
            icono.style.width = "32px";
            icono.style.height = "32px";

            const cantidadElement = document.createElement("span");
            cantidadElement.textContent = ingrediente.cantidad;

            ingredienteItem.appendChild(icono);
            ingredienteItem.appendChild(cantidadElement);

            listaCategoria.appendChild(ingredienteItem);

            // Agregar eventos al icono (mouseover, mouseout, dragstart)
            icono.addEventListener("mouseover", () => {
                tooltip.style.display = "block";
                tooltip.style.left = (event.pageX + 10) + "px";
                tooltip.style.top = (event.pageY + 10) + "px";
                tooltip.textContent = icono.alt;
            });
            icono.addEventListener("mouseout", () => {
                tooltip.style.display = "none";
            });
            icono.addEventListener("dragstart", (event) => {
                event.dataTransfer.setData("text/plain", ingrediente.nombre);
            });
        });
        
        // Agregar la lista de categoría a la columna de la categoría
        columnaCategoria.appendChild(listaCategoria);

        // Agregar la columna de la categoría al contenedor principal <ul> lista-ingredientes
        listaExistente.appendChild(columnaCategoria);
    }
}

document.addEventListener("DOMContentLoaded", function() {
    // Obtener el elemento <ul> donde se pueden soltar los elementos
    const listaReceta = document.getElementById("lista-receta");
    const listaExistente = document.getElementById("lista-ingredientes");
    
    // Agregar evento dragover para permitir soltar elementos
    listaReceta.addEventListener("dragover", (event) => {
        event.preventDefault(); // Evitar el comportamiento predeterminado
    });
    // Agregar evento dragover al ul lista-ingredientes para permitir soltar elementos
        listaExistente.addEventListener("dragover", (event) => {
            event.preventDefault(); // Evitar el comportamiento predeterminado
            });
    
    // Agregar evento drop para manejar el soltar de elementos
    listaReceta.addEventListener("drop", (event) => {
        event.preventDefault(); // Evitar el comportamiento predeterminado

        // Obtener el nombre del ingrediente arrastrado desde los datos transferidos
        const nombreIngrediente = event.dataTransfer.getData("text/plain");
        
        // Obtener la cantidad del ingrediente arrastrado desde el campo de entrada
        const cantidad = parseInt(document.getElementById("cantidad-ingredientes").value);
        // Llamar a la función agregarIngrediente con los datos del ingrediente arrastrado
        agregarIngrediente(nombreIngrediente, cantidad);
    });
    
    listaExistente.addEventListener("drop", (event) => {
            event.preventDefault(); // Evitar el comportamiento predeterminado
            // Obtener el nombre del ingrediente arrastrado desde los datos transferidos
            const nombreIngrediente = event.dataTransfer.getData("text/plain");
    
            // Obtener la cantidad del ingrediente arrastrado desde el campo de entrada
            const cantidad = parseInt(document.getElementById("cantidad-ingredientes").value);
    
            // Llamar a la función devolverIngrediente con los datos del ingrediente arrastrado
            devolverIngrediente(nombreIngrediente, cantidad);
    });

    // Agregar evento dragstart a los elementos de la lista-receta
    listaReceta.addEventListener("dragstart", (event) => {
        // Establecer los datos a transferir
        event.dataTransfer.setData("text/plain", event.target.alt);
    });
});

function devolverIngrediente(nombreIngrediente) {
    // Verificar si el ingrediente está en la lista-receta
    if (recetaPersonalizada.materiales.hasOwnProperty(nombreIngrediente)) {
        // Verificar si hay al menos un ingrediente de ese tipo en la lista-receta
        if (recetaPersonalizada.materiales[nombreIngrediente] > 0) {
            // Decrementar la cantidad de ese ingrediente en la lista-receta
            recetaPersonalizada.materiales[nombreIngrediente]--;

            // Si la cantidad del ingrediente llega a 0, eliminarlo de la receta
            if (recetaPersonalizada.materiales[nombreIngrediente] === 0) {
                delete recetaPersonalizada.materiales[nombreIngrediente];
            }

            // Incrementar la cantidad del ingrediente en el inventario
            if (inventario.hasOwnProperty(nombreIngrediente)) {
                inventario[nombreIngrediente].cantidad++;
            } else {
                console.error("El ingrediente no está en el inventario:", nombreIngrediente);
            }

            // Volver a renderizar los ingredientes en lista-ingredientes
        renderizarIngredientes();
        mostrarRecetaPersonalizada();

        } else {
            console.error("No hay suficiente cantidad del ingrediente en la lista-receta:", nombreIngrediente);
        }
    } else {
        console.error("El ingrediente no está en la lista-receta:", nombreIngrediente);
    }
}
        
function mostrarRecetaPersonalizada() {
    const recetaList = document.getElementById("lista-receta");
    recetaList.innerHTML = ""; // Limpiamos la lista de receta personalizada

    // Inicializamos la cantidad total
    let cantidadTotal = 0;

    // Iteramos sobre cada ingrediente en la receta personalizada
    for (const [ingrediente, cantidad] of Object.entries(recetaPersonalizada.materiales)) {
        // Verificamos si la cantidad del ingrediente es un número
        if (!isNaN(cantidad)) {
            cantidadTotal += parseFloat(cantidad); // Sumamos la cantidad del ingrediente
        }

        // Creamos un nuevo elemento <li> para el ingrediente
        const listItem = document.createElement("li");
            listItem.style.listStyleType = "none";


        // Creamos un elemento <img> para el icono del ingrediente
        const icono = document.createElement("img");
        icono.src = obtenerURLIcono(ingrediente);
        icono.alt = ingrediente;
        icono.style.width = "22px";
        icono.style.height = "22px";

        // Creamos un elemento <span> para la cantidad del ingrediente
        const cantidadElement = document.createElement("span");

        // Verificamos si la cantidad del ingrediente es un número
        if (!isNaN(cantidad)) {
            cantidadElement.textContent = cantidad;
        } else {
            cantidadElement.textContent = "Cantidad inválida";
        }

        // Agregamos el icono y la cantidad como hijos del elemento <li>
        listItem.appendChild(icono);
        listItem.appendChild(cantidadElement);

        // Agregamos evento al icono para mostrar el nombre del ingrediente como tooltip al pasar el mouse
        icono.addEventListener("mouseover", () => {
            tooltip.style.display = "block";
            tooltip.style.left = (event.pageX + 10) + "px";
            tooltip.style.top = (event.pageY + 10) + "px";
            tooltip.textContent = icono.alt;
        });

        // Ocultar el tooltip cuando se retira el mouse del icono
        icono.addEventListener("mouseout", () => {
            tooltip.style.display = "none";
        });

        // Agregamos el elemento <li> a la lista de receta personalizada
        recetaList.appendChild(listItem);
    }

    // Mostramos la cantidad total de ingredientes en la receta personalizada
    console.log("Cantidad total de ingredientes:", cantidadTotal);
}

function mostrarItemsCreados() {
            const itemsList = document.getElementById("lista-items-creados");
            itemsList.innerHTML = ""; // Limpiamos la lista de items creados

            itemsCreados.forEach(item => {
                const listItem = document.createElement("li");
                listItem.textContent = item;
                itemsList.appendChild(listItem);
            });
        }

function mostrarRecetas() {
            const recetasSelect = document.getElementById("recetas");
            recetasSelect.innerHTML = ""; // Limpiamos el dropdown de recetas

            recetasConocidas.forEach(receta => {
                const option = document.createElement("option");
                option.value = receta;
                option.textContent = receta;
                recetasSelect.appendChild(option);
            });
        }
 
function agregarIngrediente(nombreIngrediente, cantidad) {
    // Verificar si se proporcionó un nombre de ingrediente válido y una cantidad válida
    if (nombreIngrediente && cantidad > 0) {
        // Verificar si el ingrediente está en el inventario
        if (inventario.hasOwnProperty(nombreIngrediente)) {
            // Verificar si hay suficiente cantidad en el inventario
            if (inventario[nombreIngrediente].cantidad >= cantidad) {
                // Verificar si el ingrediente ya está en la receta personalizada
                if (recetaPersonalizada.materiales.hasOwnProperty(nombreIngrediente)) {
                    // Si el ingrediente ya está en la receta personalizada, sumar la cantidad
                    recetaPersonalizada.materiales[nombreIngrediente] += cantidad;
                } else {
                    // Si el ingrediente no está en la receta personalizada, agregarlo
                    recetaPersonalizada.materiales[nombreIngrediente] = cantidad;
                }
                // Restar la cantidad utilizada del inventario
                inventario[nombreIngrediente].cantidad -= cantidad;
                
               
                // Renderizar la lista de ingredientes actualizada
                renderizarIngredientes();
                // Mostrar la receta personalizada actualizada
                mostrarRecetaPersonalizada(nombreIngrediente, cantidad);
            } else {
                // Mostrar un mensaje si no hay suficiente cantidad en el inventario
                agregarEvento("No tienes suficientes " + nombreIngrediente + " en el inventario.");
            }
        } else {
            // Mostrar un mensaje si el ingrediente no está en el inventario
            agregarEvento("El ingrediente " + nombreIngrediente + " no existe en el inventario.");
        }
    } else {
        // Mostrar un mensaje si no se proporcionó un nombre de ingrediente válido o una cantidad válida
        agregarEvento("Por favor, selecciona un ingrediente y una cantidad válida.");
    }}

        
       function limpiarReceta() {
    for (const [nombreIngrediente, cantidad] of Object.entries(recetaPersonalizada.materiales)) {
        // Verificar si el ingrediente está en el inventario
        if (inventario.hasOwnProperty(nombreIngrediente)) {
            // Sumar la cantidad utilizada al inventario
            inventario[nombreIngrediente].cantidad += cantidad;
        } else {
            // Mostrar un mensaje si el ingrediente no está en el inventario
            alert("El ingrediente " + nombreIngrediente + " no existe en el inventario.");
            return; // Salir de la función si el ingrediente no está en el inventario
        }
    }

    // Limpiar la lista de ingredientes utilizados en la receta personalizada
    recetaPersonalizada.materiales = {};

    // Actualizar la lista de ingredientes
    renderizarIngredientes();

    // Mostrar la receta personalizada actualizada
    mostrarRecetaPersonalizada();
    }
        
 function generarItem() {
    const recetaCoincidente = recetas.find(receta => sonMismosIngredientes(receta, recetaPersonalizada));

    if (recetaCoincidente) {
        let ingredientesSuficientes = true;
        
        // Verificar si hay suficientes ingredientes en la receta personalizada
        for (const [ingrediente, cantidad] of Object.entries(recetaCoincidente.materiales)) {
            if (recetaPersonalizada.materiales[ingrediente] < cantidad) {
                ingredientesSuficientes = false;
                alert(`No tienes suficientes "${ingrediente}" en la receta personalizada.`);
                break; // Salir del bucle si no hay suficientes ingredientes
            }
        }
        
        if (ingredientesSuficientes) {
            // Restar los ingredientes de la receta personalizada
            for (const [ingrediente, cantidad] of Object.entries(recetaCoincidente.materiales)) {
                recetaPersonalizada.materiales[ingrediente] -= cantidad;
            }

            // Agregar el item generado a la lista de items creados
            const itemGenerado = recetaCoincidente.nombre;
            itemsCreados.push(itemGenerado);
            mostrarItemsCreados();

            // Si el item generado no está en las recetas conocidas, agregarlo y mostrarlas
            if (!recetasConocidas.includes(itemGenerado)) {
                recetasConocidas.push(itemGenerado);
                mostrarRecetas();
            }

            alert("¡Item generado exitosamente: " + itemGenerado + "!");
            limpiarReceta();
            mostrarRecetaPersonalizada();
            localStorage.setItem(getUsuarioActual() + "-inventario", JSON.stringify(inventario));
        }
    } else {
        alert("¡No hay una receta conocida que coincida con los ingredientes seleccionados!");
    }
}

function procesarIngrediente() {
    const recetaCoincidente = recetasProcesarIngredientes.find(receta => sonMismosIngredientes(receta, recetaPersonalizada));

    if (recetaCoincidente) {
        const ingredientesReceta = recetaCoincidente.materiales;

        let ingredientesSuficientes = true;
        
        // Verificar si hay suficientes ingredientes en la receta personalizada
        for (const [ingrediente, cantidad] of Object.entries(ingredientesReceta)) {
            if (recetaPersonalizada.materiales[ingrediente] < cantidad) {
                ingredientesSuficientes = false;
                alert(`No tienes suficientes "${ingrediente}" en la receta personalizada.`);
                break; // Salir del bucle si no hay suficientes ingredientes
            }
        }
        
        if (ingredientesSuficientes) {
            const nuevoIngrediente = recetaCoincidente.nuevoIngrediente;
            const cantidadNuevoIngrediente = recetaCoincidente.cantidadNuevoIngrediente;
            const categoriaNuevoIngrediente = recetaCoincidente.categoriaNuevoIngrediente;

            if (nuevoIngrediente && cantidadNuevoIngrediente && categoriaNuevoIngrediente) {
                // Incrementar la cantidad del nuevo ingrediente en el inventario
                if (inventario.hasOwnProperty(nuevoIngrediente)) {
                    inventario[nuevoIngrediente].cantidad += cantidadNuevoIngrediente;
                } else {
                    inventario[nuevoIngrediente] = { cantidad: cantidadNuevoIngrediente, categoria: categoriaNuevoIngrediente };
                }

                // Restar la cantidad de los ingredientes de la receta personalizada
                for (const [ingrediente, cantidad] of Object.entries(ingredientesReceta)) {
                    recetaPersonalizada.materiales[ingrediente] -= cantidad;
                }

                alert(`¡Nuevo ingrediente "${nuevoIngrediente}" agregado al inventario!`);
                renderizarIngredientes();
                mostrarRecetaPersonalizada();
                limpiarReceta(); // Limpiar la receta personalizada después de procesar el ingrediente
                localStorage.setItem(getUsuarioActual() + "-inventario", JSON.stringify(inventario));
            } else {
                alert("Error: La receta coincide pero no se especificó un nuevo ingrediente.");
            }
        }
    } else {
        alert("Error: No hay una receta de procesamiento de ingredientes que coincida con los ingredientes seleccionados.");
    }
}

function usarMortero() {
    // Obtener el nombre del ingrediente y la cantidad desde la receta personalizada
    const nombreIngrediente = recetaPersonalizada.materiales.nombreIngrediente;
    const cantidadIngrediente = recetaPersonalizada.materiales.cantidad;

    // Buscar el ingrediente correspondiente en las listas ingredientesBasico, ingredientesIntermedio e ingredientesAvanzado
    const ingredienteBasico = ingredientesBasico.find(ingrediente => ingrediente.nombre === nombreIngrediente);
    const ingredienteIntermedio = ingredientesIntermedio.find(ingrediente => ingrediente.nombre === nombreIngrediente);
    const ingredienteAvanzado = ingredientesAvanzado.find(ingrediente => ingrediente.nombre === nombreIngrediente);

    // Si se encuentra el ingrediente en alguna de las listas, asignar sus valores correspondientes
    let neutro, veneno, curacion, magia, humedad;
    let nombre;
    if (ingredienteBasico) {
        ({ neutro, veneno, curacion, magia, humedad, nombre } = ingredienteBasico);
    } else if (ingredienteIntermedio) {
        ({ neutro, veneno, curacion, magia, humedad, nombre } = ingredienteIntermedio);
    } else if (ingredienteAvanzado) {
        ({ neutro, veneno, curacion, magia, humedad, nombre } = ingredienteAvanzado);
    } else {
        console.error("El ingrediente no se encontró en ninguna lista.");
        return;
    }

    // Encontramos el valor más alto entre neutro, veneno, curacion y magia
    const maximo = Math.max(neutro, veneno, curacion, magia);

    // Sumamos 2 al valor máximo
    const nuevoValor = maximo + 2;

    // Asignamos el nuevo valor al más alto entre neutro, veneno, curación y magia
    if (maximo === neutro) {
        ingredienteOriginal.neutro = nuevoValor;
    } else if (maximo === veneno) {
        ingredienteOriginal.veneno = nuevoValor;
    } else if (maximo === curacion) {
        ingredienteOriginal.curacion = nuevoValor;
    } else {
        ingredienteOriginal.magia = nuevoValor;
    }

    // Determinamos el tipo de resultado basado en el factor de humedad
    let tipoResultado, icono;
    if (humedad > 6) {
        tipoResultado = "Pasta";
        icono = "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_28_100.png";
    } else if (humedad < 4) {
        tipoResultado = "Polvo";
        icono = "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/icons_30_11.png";
    } else {
        tipoResultado = "Masa";
        icono = "https://raw.githubusercontent.com/PedroAbascal/tryhtml/main/recursos/Icons/Icons_27_68.png";
    }

    // Creamos el nuevo ingrediente con el nombre, icono y las propiedades respectivas
    const cantidadNuevoIngrediente = cantidadIngredienteOriginal;
    const nuevoIngrediente = {
        nombre: tipoResultado + " de " + nombre,
        icono: icono,
        neutro: ingredienteOriginal.neutro,
        veneno: ingredienteOriginal.veneno,
        curacion: ingredienteOriginal.curacion,
        magia: ingredienteOriginal.magia,
        humedad: ingredienteOriginal.humedad,
        atributo: ingredienteOriginal.atributo,
        efecto_magico: ingredienteOriginal.efecto_magico,
        ph: ingredienteOriginal.ph,
        nutricion: ingredienteOriginal.nutricion,
        dominio: ingredienteOriginal.dominio,
        rareza: ingredienteOriginal.rareza,
        categoria: tipoResultado
    };

    // Agregamos el nuevo ingrediente al inventario
    agregarNuevoIngrediente(nuevoIngrediente, cantidadNuevoIngrediente);

    // Aquí implementaríamos la lógica para procesar el ingrediente y generar la receta
}

// Función para agregar el nuevo ingrediente al inventario
function agregarNuevoIngrediente(nuevoIngrediente, cantidadNuevoIngrediente) {
    // Incrementar la cantidad del nuevo ingrediente en el inventario
    if (inventario.hasOwnProperty(nuevoIngrediente.nombre)) {
        inventario[nuevoIngrediente.nombre].cantidad += cantidadNuevoIngrediente;
    } else {
        inventario[nuevoIngrediente.nombre] = { cantidad: cantidadNuevoIngrediente, categoria: nuevoIngrediente.categoria };
    }

    // Mostrar mensaje de éxito y actualizar la interfaz
    alert(`¡${cantidadNuevoIngrediente} nuevo(s) ingrediente(s) "${nuevoIngrediente.nombre}" agregado(s) al inventario!`);
    renderizarIngredientes();
}
        
        function sonMismosIngredientes(receta1, receta2) {
            const ingredientes1 = receta1.materiales;
            const ingredientes2 = receta2.materiales;
            const keys1 = Object.keys(ingredientes1);
            const keys2 = Object.keys(ingredientes2);
            if (keys1.length !== keys2.length) return false;
            for (const key of keys1) {
                if (ingredientes1[key] !== ingredientes2[key]) return false;
            }
            return true;
        }

        // Función para agregar un evento al log
        function agregarEvento(evento) {
            const logList = document.getElementById("log-list");
            const listItem = document.createElement("li");
            listItem.textContent = evento;
            logList.appendChild(listItem);
        }
        // Función para obtener el usuario actual desde localStorage
        function getUsuarioActual() {
        return localStorage.getItem("usuarioActual");
        }

    function agregarIngredientes(listaIngredientes) {
        listaIngredientes.forEach(ingrediente => {
        const nombreIngrediente = ingrediente.nombre;
        const cantidad = ingrediente.cantidad;
        const categoria = ingrediente.categoria;

        // Comprobamos si el ingrediente ya existe en el inventario
        if (inventario.hasOwnProperty(nombreIngrediente)) {
            // Si el ingrediente ya existe, actualizamos su cantidad y categoría
            inventario[nombreIngrediente].cantidad += cantidad;
            inventario[nombreIngrediente].categoria = categoria;
            console.log(`Agregando ingrediente: ${nombreIngrediente} Cantidad: ${cantidad} Categoria: ${categoria}`);
        } else {
            // Si el ingrediente no existe, lo agregamos al inventario con la cantidad y categoría
            inventario[nombreIngrediente] = { cantidad: cantidad, categoria: categoria };
            console.log(`Agregando nuevo ingrediente: ${nombreIngrediente} Cantidad: ${cantidad} Categoria: ${categoria}`);
        }
    });

    // Guardar el estado actualizado del inventario en localStorage
    localStorage.setItem(getUsuarioActual() + "-inventario", JSON.stringify(inventario));

    // Renderizar la lista de ingredientes con el inventario actualizado
    renderizarIngredientes();
}

// Eventos para los botones de agregar ingredientes
        document.getElementById("agregar-basico").addEventListener("click", function() {
            agregarIngredientes(ingredientesBasico);
        });

        document.getElementById("agregar-intermedio").addEventListener("click", function() {
            agregarIngredientes(ingredientesIntermedio);
        });

        document.getElementById("agregar-avanzado").addEventListener("click", function() {
            agregarIngredientes(ingredientesAvanzado);
        });

        
      // Evento para el botón de iniciar sesión
    document.getElementById("login-btn").addEventListener("click", function() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    const usuario = usuariosRegistrados.find(user => user.nombre === username && user.contraseña === password);
        
    if (usuario) {
        // Simulación de inicio de sesión exitoso
        agregarEvento("Inicio de sesión exitoso para el usuario: " + username);
        document.getElementById("inicio-sesion").style.display = "none";
        document.getElementById("guardar-localstorage-btn").style.display = "inline-block";
        document.getElementById("items-creados-section").style.display = "inline-block";
        document.getElementById("generador-section").style.display = "inline-block";
        document.getElementById("ingredientes-section").style.display = "inline-block";
        document.getElementById("agregar-inventario-section").style.display = "inline-block";
        document.getElementById("procesar-ingrediente").style.display = "inline-block"; // Mostrar el botón "Procesar Ingrediente"
        // document.getElementById("resultado").style.display = "inline-block";
        // Establecer usuario actual en localStorage
        console.log("Usuario actual establecido en localStorage:", username);
        localStorage.setItem("usuarioActual", username);
        
        // Cargar datos del usuario desde localStorage
        cargarEstadoUsuario(username);
        renderizarIngredientes(inventario);;
        mostrarRecetaPersonalizada();
        mostrarRecetas();
        mostrarItemsCreados();
    } else {
        alert("Inicio de sesión fallido: ¡Nombre de usuario o contraseña incorrectos!");
    }
});
// Verificar si hay un usuario actual almacenado en localStorage al cargar la página
window.addEventListener("load", function() {
    const usuarioActual = getUsuarioActual();
    if (usuarioActual) {
        // Ocultar formulario de inicio de sesión y mostrar secciones relevantes
        document.getElementById("inicio-sesion").style.display = "none";
        document.getElementById("inventario-section").style.display = "inline-block";
        document.getElementById("items-creados-section").style.display = "inline-block";
        document.getElementById("generador-section").style.display = "inline-block";
        document.getElementById("ingredientes-section").style.display = "inline-block";
        document.getElementById("resultado").style.display = "inline-block";
        // Cargar datos del usuario desde localStorage
        cargarEstadoUsuario(usuarioActual);
    }
});
       // Evento para el botón de registro
document.getElementById("registro-btn").addEventListener("click", function() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    if (username && password) {
        // Verificar si el usuario ya existe
        const usuarioExistente = usuariosRegistrados.find(user => user.nombre === username);
        if (usuarioExistente) {
            agregarEvento("Registro fallido: ¡El nombre de usuario ya está en uso!");
        } else {
            // Simulación de registro exitoso
            agregarEvento("Usuario registrado exitosamente: " + username);
            document.getElementById("inicio-sesion").style.display = "none";
            document.getElementById("inventario-section").style.display = "inline-block";
            document.getElementById("items-creados-section").style.display = "inline-block";
            document.getElementById("generador-section").style.display = "inline-block";
            document.getElementById("ingredientes-section").style.display = "inline-block";
            document.getElementById("resultado").style.display = "inline-block";
            // Guardar el nombre de usuario en localStorage
            localStorage.setItem("usuarioActual", username);
            // Agregar nuevo usuario registrado a la lista
            usuariosRegistrados.push({ nombre: username, contraseña: password });
            // Guardar estado del usuario en cookies
            guardarEstadoUsuario(username);
        }
    } else {
        agregarEvento("Registro fallido: ¡Ingrese un nombre de usuario y contraseña!");
    }
});


document.getElementById("agregar-ingredientes-receta").addEventListener("click", function() {
    const recetaSeleccionada = document.getElementById("recetas").value;
    const recetaEncontrada = recetas.find(receta => receta.nombre === recetaSeleccionada);

    if (recetaEncontrada) {
        let ingredientesSuficientes = true;
        
        // Verificar si hay suficientes ingredientes en el inventario para la receta seleccionada
        for (const [ingrediente, cantidad] of Object.entries(recetaEncontrada.materiales)) {
            if (inventario[ingrediente] < cantidad) {
                ingredientesSuficientes = false;
                alert(`No tienes suficientes "${ingrediente}" en el inventario.`);
                break; // Salir del bucle si no hay suficientes ingredientes
            }
        }
        
        if (ingredientesSuficientes) {
            // Agregar los ingredientes de la receta personalizada solo si hay suficientes en el inventario
            for (const [ingrediente, cantidad] of Object.entries(recetaEncontrada.materiales)) {
                // Verificar que haya suficientes ingredientes en el inventario antes de agregarlos
                // if (inventario[ingrediente] >= cantidad) {
                recetaPersonalizada.materiales[ingrediente] = (recetaPersonalizada.materiales[ingrediente] || 0) + cantidad;
                inventario[ingrediente] -= cantidad;
                // }
            }
            
            // Renderizar los ingredientes actualizados en lista-ingredientes
            renderizarIngredientes();
            mostrarRecetaPersonalizada();
            agregarEvento("Ingredientes de receta agregados con éxito.");
        }
    } 
});


        // Evento para el botón de generar item
        document.getElementById("generar-item").addEventListener("click", generarItem);

        // Evento para el botón de agregar ingrediente a la receta personalizada
        document.getElementById("agregar-ingrediente").addEventListener("click", usarMortero);

        // Evento para el botón de limpiar receta personalizada
        document.getElementById("limpiar-receta").addEventListener("click", limpiarReceta);

      // Función para guardar el estado del usuario en localStorage
    function guardarEstadoUsuario(username) {
    localStorage.setItem(username + "-itemsCreados", JSON.stringify(itemsCreados)); // Guardar items creados
    localStorage.setItem(username + "-inventario", JSON.stringify(inventario)); // Guardar estado del inventario
    localStorage.setItem("usuariosRegistrados", JSON.stringify(usuariosRegistrados)); // Guardar usuarios registrados
    localStorage.setItem("usuarioActual", username); // Guardar usuario actual
    localStorage.setItem(username + "-recetasProcesarIngredientes", JSON.stringify(recetasProcesarIngredientes)); // Guardar recetas de procesar ingredientes
}


        document.getElementById("procesar-ingrediente").addEventListener("click", procesarIngrediente);
        
       // Función para cargar el estado del usuario desde localStorage
function cargarEstadoUsuario(username) {
            const inventarioLocalStorage = localStorage.getItem(username + "-inventario");
            if (inventarioLocalStorage) {
                inventario = JSON.parse(inventarioLocalStorage);
            }

            const itemsCreadosLocalStorage = localStorage.getItem(username + "-itemsCreados");
            if (itemsCreadosLocalStorage) {
                itemsCreados = JSON.parse(itemsCreadosLocalStorage);
            }

            const recetasConocidasLocalStorage = localStorage.getItem(username + "-recetasConocidas");
            if (recetasConocidasLocalStorage) {
                recetasConocidas = JSON.parse(recetasConocidasLocalStorage);
            }
    const recetasProcesarIngredientesLocalStorage = localStorage.getItem(username + "-recetasProcesarIngredientes"); // Cargar recetas de procesar ingredientes
    if (recetasProcesarIngredientesLocalStorage) {
        recetasProcesarIngredientes = JSON.parse(recetasProcesarIngredientesLocalStorage);
    }
        }

        // Función para guardar el estado del usuario en localStorage
        function guardarEstadoUsuario(username) {
            localStorage.setItem(username + "-inventario", JSON.stringify(inventario));
            localStorage.setItem(username + "-itemsCreados", JSON.stringify(itemsCreados));
            localStorage.setItem(username + "-recetasConocidas", JSON.stringify(recetasConocidas));
        }

        
// Evento para el botón de guardar información en localStorage
document.getElementById("guardar-localstorage-btn").addEventListener("click", function() {
    const username = localStorage.getItem("usuarioActual");
    if (username) {
        guardarEstadoUsuario(username);
        alert("¡Información guardada en localStorage!");
    } else {
        alert("No hay usuario actualmente iniciado sesión.");
    }
});
        // Función para obtener el nombre de usuario actual
        function getUsuarioActual() {
            return document.getElementById("username").value;
        }

        // Mostrar recetas iniciales
        mostrarRecetas();

    </script>
</body>
</html>
