<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Items y Pociones de D&D 5e</title>
    <style>
        /* Estilos CSS pueden ser añadidos aquí */
        .ingredient-icon {
            width: 50px;
            height: 50px;
            background-color: #ccc;
            border: 1px solid #999;
            border-radius: 50%;
            display: inline-block;
            margin: 10px;
            cursor: pointer;
        }

        .receta-personalizada {
            border: 2px dashed #999;
            padding: 20px;
            margin-top: 20px;
        }

        .section {
            display: inline-block;
            vertical-align: top;
            margin-right: 20px;
        }

        .section h2 {
            margin-bottom: 10px;
        }

        #inicio-sesion {
            display: block;
        }

        #inventario-section,
        #items-creados-section,
        #generador-section,
        #ingredientes-section,
        #event-log,
        #agregar-inventario-section,
        #guardar-localstorage-btn,
        #receta-personalizada {
            display: none;
        }
    </style>
</head>
<body>
    
    <h1>Generador de Items y Pociones de D&D 5e</h1>

    <!-- Inicio de Sesión -->
    <div id="inicio-sesion" class="section">
        <h2>Iniciar Sesión</h2>
        <label for="username">Nombre de Usuario:</label>
        <input type="text" id="username">
        <label for="password">Contraseña:</label>
        <input type="password" id="password">
        <button id="login-btn">Iniciar Sesión</button>
        <button id="registro-btn">Registrarse</button>
    </div>

    <!-- Botón Guardar Estado -->
    <div class="section">
        <button id="guardar-localstorage-btn">Guardar Estado</button>
    </div>

    <!-- Lista de Items Creados -->
    <div id="items-creados-section" class="section">
        <h2>Items Creados</h2>
        <ul id="lista-items-creados">
            <!-- Aquí se mostrarán los items creados -->
        </ul>
    </div>

    <!-- Seleccionar Receta, Agregar Ingredientes de Receta y Generar Item -->
    <div id="generador-section" class="section">
        <label for="recetas">Selecciona una receta:</label>
        <select id="recetas">
            <!-- Las opciones serán agregadas dinámicamente -->
        </select>
        <button id="agregar-ingredientes-receta">Agregar Ingredientes de Receta</button>
        <button id="generar-item">Generar Item</button>
    </div>

    <!-- Seleccionar un Ingrediente, Selector de Cantidad, Agregar Ingrediente y Limpiar Receta -->
    <div id="ingredientes-section" class="section">
        <h2>Selecciona un ingrediente</h2>
        <div id="ingredientes">
            <div class="ingredient-icon" draggable="true" ondragstart="drag(event)" id="Agua"></div>
            <div class="ingredient-icon" draggable="true" ondragstart="drag(event)" id="Hierbas"></div>
            <div class="ingredient-icon" draggable="true" ondragstart="drag(event)" id="Raíz de mandrágora"></div>
            <!-- Agrega más ingredientes aquí si es necesario -->
        </div>
        <input type="number" id="cantidad-ingredientes" value="1" min="1">
        <button id="agregar-ingrediente">Agregar Ingrediente</button>
        <button id="limpiar-receta">Limpiar Receta</button>
    </div>

    <!-- Log de Eventos -->
    <div id="event-log" class="section">
        <h2>Eventos</h2>
        <ul id="log-list">
            <!-- Aquí se mostrarán los eventos -->
        </ul>
    </div>

    <!-- Receta Personalizada -->
    <div id="receta-personalizada" class="receta-personalizada" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h2>Receta Personalizada</h2>
        <ul id="lista-receta"></ul>
    </div>

    <script>
        // JavaScript puede ser añadido aquí
        function allowDrop(ev) {
            ev.preventDefault();
        }
        
        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }
        
        function drop(ev) {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("text");
            var ingrediente = document.getElementById(data);
            var listaReceta = document.getElementById("lista-receta");
            var listItem = document.createElement("li");
            listItem.textContent = "Ingrediente: " + data;
            listaReceta.appendChild(listItem);
            ev.target.appendChild(ingrediente);
        }

        // Resto del código JavaScript...
        let usuariosRegistrados = [
            { nombre: "usuario1", contraseña: "usuario1" },
            { nombre: "usuario2", contraseña: "usuario2" },
            { nombre: "usuario3", contraseña: "usuario3" },
            { nombre: "usuario4", contraseña: "usuario4" },
            { nombre: "usuario5", contraseña: "usuario5" }
        ];

        let recetasConocidas = [];
        let recetas = [
            { nombre: "Poción de curación", materiales: { Agua: 1, Hierbas: 1, "Raíz de mandrágora": 1 }, efecto: "Cura 2d4 + 2 puntos de golpe." },
            { nombre: "Espada larga", materiales: { Metal: 2, Madera: 1 }, efecto: "Arma cuerpo a cuerpo que causa 1d8 de daño cortante." }
            // Puedes añadir más recetas aquí
        ];

        let recetaPersonalizada = {
            nombre: "Receta personalizada",
            materiales: {}
        };

        let inventario = {
            Agua: 10,
            Hierbas: 5,
            "Raíz de mandrágora": 3,
            Metal: 0,
            Madera: 0,
            Oro: 0,
            Diamante: 0
        };

        const ingredientesBasico = [
            { nombre: "Agua", cantidad: 5 },
            { nombre: "Hierbas", cantidad: 5 },
            { nombre: "Raíz de mandrágora", cantidad: 5 }
        ];

        const ingredientesIntermedio = [
            { nombre: "Metal", cantidad: 3 },
            { nombre: "Madera", cantidad: 3 }
        ];

        const ingredientesAvanzado = [
            { nombre: "Oro", cantidad: 1 },
            { nombre: "Diamante", cantidad: 1 }
        ];

        let itemsCreados = [];

        function mostrarRecetaPersonalizada() {
            const recetaList = document.getElementById("lista-receta");
            recetaList.innerHTML = ""; // Limpiamos la lista de receta personalizada

            for (const [ingrediente, cantidad] of Object.entries(recetaPersonalizada.materiales)) {
                const listItem = document.createElement("li");
                listItem.textContent = `${ingrediente}: ${cantidad}`;
                recetaList.appendChild(listItem);
            }
        }

        function generarItem() {
            // Verificamos si los ingredientes seleccionados coinciden con alguna receta conocida
            const recetaCoincidente = recetas.find(receta => sonMismosIngredientes(receta, recetaPersonalizada));

            if (recetaCoincidente) {
                // Restar los ingredientes del inventario
                for (const [ingrediente, cantidad] of Object.entries(recetaCoincidente.materiales)) {
                    inventario[ingrediente] -= cantidad;
                }

                // Eliminar los ingredientes del inventario que tienen una cantidad igual a cero
                for (const ingrediente in inventario) {
                    if (inventario[ingrediente] === 0) {
                        delete inventario[ingrediente];
                    }
                }

                // Actualizar la lista de selección de ingredientes
                mostrarInventario();

                const itemGenerado = recetaCoincidente.nombre;
                itemsCreados.push(itemGenerado);
                mostrarItemsCreados();

                if (!recetasConocidas.includes(itemGenerado)) {
                    recetasConocidas.push(itemGenerado);
                    mostrarRecetas(); // Mostramos las recetas conocidas actualizadas
                }

                alert("¡Item generado exitosamente: " + itemGenerado + "!");
                // Actualizar el inventario mostrado
                mostrarInventario();
            } else {
                alert("¡No hay una receta conocida que coincida con los ingredientes seleccionados!");
            }
        }

        function sonMismosIngredientes(receta1, receta2) {
            const ingredientes1 = receta1.materiales;
            const ingredientes2 = receta2.materiales;
            const keys1 = Object.keys(ingredientes1);
            const keys2 = Object.keys(ingredientes2);
            if (keys1.length !== keys2.length) return false;
            for (const key of keys1) {
                if (ingredientes1[key] !== ingredientes2[key]) return false;
            }
            return true;
        }

        // Función para agregar un evento al log
        function agregarEvento(evento) {
            const logList = document.getElementById("log-list");
            const listItem = document.createElement("li");
            listItem.textContent = evento;
            logList.appendChild(listItem);
        }

        // Evento para el botón de generar item
        document.getElementById("generar-item").addEventListener("click", generarItem);

        // Evento para el botón de iniciar sesión
        document.getElementById("login-btn").addEventListener("click", function() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const usuario = usuariosRegistrados.find(user => user.nombre === username && user.contraseña === password);
            if (usuario) {
                // Simulación de inicio de sesión exitoso
                agregarEvento("Inicio de sesión exitoso para el usuario: " + username);
                document.getElementById("inicio-sesion").style.display = "none";
                document.getElementById("guardar-localstorage-btn").style.display = "inline-block";
                document.getElementById("items-creados-section").style.display = "inline-block";
                document.getElementById("generador-section").style.display = "inline-block";
                document.getElementById("ingredientes-section").style.display = "inline-block";
                // Establecer usuario actual en localStorage
                console.log("Usuario actual establecido en localStorage:", username);
                localStorage.setItem("usuarioActual", username);
                
                // Restaurar estado guardado del inventario
                //restaurarInventario();
            } else {
                alert("Nombre de usuario o contraseña incorrectos");
            }
        });
    </script>
</body>
</html>
